<!DOCTYPE html>
<!-- saved from url=(0055)file:///C:/Users/ssoryxxx/Downloads/study-ai-app_3.html -->
<html lang="ru"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="StudyAI">
<title>StudyAI</title>
<link href="./index_files/css2" rel="stylesheet">
<style>
:root {
  --bg: #0d0e1a;
  --card: #13152a;
  --card2: #1a1d35;
  --border: rgba(255,255,255,0.06);
  --border2: rgba(255,255,255,0.12);
  --text: #e8eaf6;
  --muted: #4a5080;
  --muted2: #7880a8;
  --r: 16px;
  --st: env(safe-area-inset-top,0px);
  --sb: env(safe-area-inset-bottom,0px);

  /* Subject colors */
  --eng: #34d399;
  --math: #f59e0b;
  --bp: #38bdf8;
  --ru: #f472b6;
  --macro: #a78bfa;
  --gen: #6366f1;
}

* { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

body {
  font-family: 'Space Grotesk', sans-serif;
  background: var(--bg);
  color: var(--text);
  height: 100dvh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  position: fixed;
  width: 100%;
}

/* Animated background grid */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background-image:
    linear-gradient(rgba(99,102,241,0.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(99,102,241,0.03) 1px, transparent 1px);
  background-size: 40px 40px;
  pointer-events: none;
  z-index: 0;
}

/* HEADER */
.hdr {
  padding: calc(var(--st) + 10px) 16px 10px;
  background: rgba(13,14,26,0.95);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border);
  flex-shrink: 0;
  z-index: 20;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: relative;
}

.logo {
  display: flex;
  align-items: center;
  gap: 10px;
}

.logo-icon {
  width: 32px; height: 32px;
  border-radius: 9px;
  background: linear-gradient(135deg, #6366f1, #a78bfa);
  display: flex; align-items: center; justify-content: center;
  font-size: .9rem;
  box-shadow: 0 0 20px rgba(99,102,241,0.4);
}

.logo-text {
  font-size: 1.1rem;
  font-weight: 700;
  letter-spacing: -.02em;
  color: #fff;
}

.logo-text span { color: var(--muted2); font-weight: 400; font-size: .75rem; margin-left: 6px; }

.hbtn {
  width: 34px; height: 34px;
  border-radius: 10px;
  background: var(--card);
  border: 1px solid var(--border2);
  color: var(--muted2);
  display: flex; align-items: center; justify-content: center;
  cursor: pointer;
  font-size: .85rem;
  transition: all .15s;
}
.hbtn:active { transform: scale(.9); }

/* TABS ‚Äî Pill style */
.tabs-wrap {
  flex-shrink: 0;
  background: var(--bg);
  border-bottom: 1px solid var(--border);
  padding: 8px 12px;
  overflow-x: auto;
  scrollbar-width: none;
  position: relative;
  z-index: 10;
}
.tabs-wrap::-webkit-scrollbar { display: none; }
.tabs {
  display: flex;
  gap: 5px;
  width: max-content;
}

.tab {
  display: flex;
  align-items: center;
  gap: 5px;
  padding: 6px 13px;
  border-radius: 100px;
  font-size: .75rem;
  font-weight: 500;
  color: var(--muted2);
  cursor: pointer;
  border: 1px solid var(--border);
  background: transparent;
  transition: all .18s;
  white-space: nowrap;
  letter-spacing: .01em;
}
.tab:active { transform: scale(.95); }

.tab[data-s="gen"].on { background: rgba(99,102,241,.18); border-color: rgba(99,102,241,.4); color: #a5b4fc; }
.tab[data-s="eng"].on { background: rgba(52,211,153,.15); border-color: rgba(52,211,153,.4); color: #6ee7b7; }
.tab[data-s="math"].on { background: rgba(245,158,11,.15); border-color: rgba(245,158,11,.4); color: #fcd34d; }
.tab[data-s="bp"].on { background: rgba(56,189,248,.15); border-color: rgba(56,189,248,.4); color: #7dd3fc; }
.tab[data-s="ru"].on { background: rgba(244,114,182,.15); border-color: rgba(244,114,182,.4); color: #f9a8d4; }
.tab[data-s="macro"].on { background: rgba(167,139,250,.15); border-color: rgba(167,139,250,.4); color: #c4b5fd; }

.tab-dot {
  width: 6px; height: 6px;
  border-radius: 50%;
}
.tab[data-s="gen"] .tab-dot { background: var(--gen); }
.tab[data-s="eng"] .tab-dot { background: var(--eng); }
.tab[data-s="math"] .tab-dot { background: var(--math); }
.tab[data-s="bp"] .tab-dot { background: var(--bp); }
.tab[data-s="ru"] .tab-dot { background: var(--ru); }
.tab[data-s="macro"] .tab-dot { background: var(--macro); }

/* STATUS */
.statusbar {
  padding: 6px 16px;
  font-size: .73rem;
  text-align: center;
  display: none;
  flex-shrink: 0;
  font-family: 'JetBrains Mono', monospace;
}
.statusbar.err { display: block; color: #ff6b6b; background: rgba(255,107,107,.07); border-bottom: 1px solid rgba(255,107,107,.1); }
.statusbar.ok { display: block; color: #34d399; background: rgba(52,211,153,.06); border-bottom: 1px solid rgba(52,211,153,.1); }

/* MESSAGES */
.msgs {
  flex: 1;
  overflow-y: auto;
  padding: 16px 14px 8px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  scroll-behavior: smooth;
  position: relative;
  z-index: 1;
}
.msgs::-webkit-scrollbar { display: none; }

/* WELCOME SCREEN ‚Äî Dashboard style */
.welcome {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  flex: 1;
  padding: 16px;
  gap: 16px;
}

.welcome-hero {
  text-align: center;
}

.welcome-hero .glow {
  width: 60px; height: 60px;
  border-radius: 18px;
  background: linear-gradient(135deg, #6366f1, #a78bfa);
  display: flex; align-items: center; justify-content: center;
  font-size: 1.6rem;
  margin: 0 auto 12px;
  box-shadow: 0 0 40px rgba(99,102,241,.35), 0 0 80px rgba(99,102,241,.15);
}

.welcome-hero h2 {
  font-size: 1.15rem;
  font-weight: 700;
  letter-spacing: -.02em;
  color: #fff;
  margin-bottom: 4px;
}
.welcome-hero p { color: var(--muted2); font-size: .8rem; line-height: 1.5; }

/* Quick action cards ‚Äî Dashboard grid */
.qgrid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 7px;
  width: 100%;
  max-width: 360px;
}

.qcard {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 13px;
  padding: 11px 12px;
  cursor: pointer;
  transition: all .18s;
  position: relative;
  overflow: hidden;
}
.qcard::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 2px;
  border-radius: 13px 13px 0 0;
}
.qcard[data-c="eng"]::before { background: var(--eng); }
.qcard[data-c="math"]::before { background: var(--math); }
.qcard[data-c="bp"]::before { background: var(--bp); }
.qcard[data-c="ru"]::before { background: var(--ru); }
.qcard[data-c="macro"]::before { background: var(--macro); }

.qcard:active { transform: scale(.97); background: var(--card2); }
.qcard-ico { font-size: 1.1rem; margin-bottom: 5px; }
.qcard-title { font-size: .74rem; font-weight: 600; color: var(--text); line-height: 1.3; }
.qcard-sub { font-size: .66rem; color: var(--muted2); margin-top: 2px; line-height: 1.3; }

/* MESSAGES */
.msg { display: flex; gap: 8px; animation: fu .25s ease; max-width: 100%; }
.msg.usr { flex-direction: row-reverse; }

.av {
  width: 28px; height: 28px;
  border-radius: 9px;
  flex-shrink: 0;
  display: flex; align-items: center; justify-content: center;
  font-size: .7rem; font-weight: 700;
  margin-top: 3px;
}
.aiav {
  background: linear-gradient(135deg, #6366f1, #a78bfa);
  color: #fff;
  font-family: 'JetBrains Mono', monospace;
  box-shadow: 0 0 12px rgba(99,102,241,.4);
}
.usrav {
  background: var(--card2);
  color: var(--muted2);
  border: 1px solid var(--border2);
}

.bub {
  max-width: calc(100% - 40px);
  padding: 10px 13px;
  border-radius: 14px;
  font-size: .85rem;
  line-height: 1.7;
  word-break: break-word;
}
.aibub {
  background: var(--card);
  border: 1px solid var(--border2);
  border-bottom-left-radius: 4px;
}
.usrbub {
  background: rgba(99,102,241,.12);
  border: 1px solid rgba(99,102,241,.2);
  border-bottom-right-radius: 4px;
}

.bub img {
  max-width: 100%; border-radius: 10px;
  margin-bottom: 6px; display: block;
  max-height: 220px; object-fit: contain;
}
.imgrid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(100px,1fr));
  gap: 4px; margin-bottom: 6px;
}
.imgrid img { width: 100%; height: 85px; object-fit: cover; border-radius: 8px; margin: 0; }

/* Rich content styling */
.math-blk {
  font-family: 'JetBrains Mono', monospace;
  font-size: .78rem; line-height: 2;
  background: rgba(245,158,11,.06);
  border: 1px solid rgba(245,158,11,.15);
  border-left: 3px solid #f59e0b;
  border-radius: 0 10px 10px 0;
  padding: 10px 13px; margin: 8px 0;
  color: #fde68a; overflow-x: auto; white-space: pre;
}
.step-lbl {
  display: block; color: #34d399;
  font-size: .7rem; font-weight: 600;
  text-transform: uppercase; letter-spacing: .07em;
  margin: 10px 0 2px;
  font-family: 'JetBrains Mono', monospace;
}
.ans-box {
  background: rgba(52,211,153,.08);
  border: 1.5px solid rgba(52,211,153,.4);
  border-radius: 10px; padding: 9px 13px;
  margin: 8px 0; color: #6ee7b7;
  font-size: .88rem; font-weight: 600; text-align: center;
  font-family: 'JetBrains Mono', monospace;
}
.rule-box {
  background: rgba(99,102,241,.07);
  border-left: 3px solid #6366f1;
  border-radius: 0 10px 10px 0;
  padding: 8px 12px; margin: 6px 0;
  color: #a5b4fc; font-size: .81rem;
}
.err-l { color: #f87171; }
.ok-l { color: #34d399; }
.bub strong { color: #fff; font-weight: 600; }
.bub code {
  background: rgba(255,255,255,.06);
  border-radius: 5px; padding: 1px 5px;
  font-family: 'JetBrains Mono', monospace;
  font-size: .78rem; color: #7dd3fc;
}
.bub pre {
  background: rgba(0,0,0,.4);
  border-radius: 10px; padding: 10px;
  overflow-x: auto; margin: 6px 0;
  border: 1px solid var(--border);
}

.sbadge {
  display: inline-flex; align-items: center; gap: 4px;
  font-size: .65rem; border-radius: 5px;
  padding: 2px 8px; margin-bottom: 6px;
  font-weight: 600; letter-spacing: .03em;
  font-family: 'JetBrains Mono', monospace;
}
.sb-gen { background: rgba(99,102,241,.12); color: #a5b4fc; }
.sb-eng { background: rgba(52,211,153,.12); color: #6ee7b7; }
.sb-math { background: rgba(245,158,11,.12); color: #fcd34d; }
.sb-bp { background: rgba(56,189,248,.12); color: #7dd3fc; }
.sb-ru { background: rgba(244,114,182,.12); color: #f9a8d4; }
.sb-macro { background: rgba(167,139,250,.12); color: #c4b5fd; }

/* Typing indicator */
.typing-wrap {
  display: flex; gap: 5px; padding: 10px 13px; align-items: center;
}
.typing-wrap span {
  width: 6px; height: 6px; border-radius: 50%;
  background: #6366f1; animation: ty 1.3s ease infinite;
}
.typing-wrap span:nth-child(2) { animation-delay: .2s; background: #a78bfa; }
.typing-wrap span:nth-child(3) { animation-delay: .4s; background: #34d399; }

/* IMAGE PREVIEWS */
.prevs {
  display: flex; gap: 6px;
  padding: 6px 14px 0;
  flex-wrap: wrap; flex-shrink: 0;
  position: relative; z-index: 5;
}
.prev {
  position: relative; width: 56px; height: 56px;
  border-radius: 10px; overflow: hidden;
  border: 1px solid var(--border2);
}
.prev img { width: 100%; height: 100%; object-fit: cover; }
.prev .rm {
  position: absolute; top: 2px; right: 2px;
  width: 15px; height: 15px;
  background: rgba(0,0,0,.8); border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: .5rem; cursor: pointer; color: #fff;
}

/* INPUT AREA */
.inp-area {
  background: rgba(13,14,26,.97);
  backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
  border-top: 1px solid var(--border);
  padding: 8px 12px calc(var(--sb) + 8px);
  flex-shrink: 0; position: relative; z-index: 10;
}
.inp-row { display: flex; gap: 6px; align-items: flex-end; }

.abtn {
  width: 36px; height: 36px;
  border-radius: 10px; background: var(--card);
  border: 1px solid var(--border2);
  color: var(--muted2);
  display: flex; align-items: center; justify-content: center;
  cursor: pointer; font-size: .85rem;
  transition: all .15s; flex-shrink: 0;
}
.abtn:active { transform: scale(.9); }

.twrap {
  flex: 1; background: var(--card);
  border: 1px solid var(--border2);
  border-radius: 12px;
  display: flex; align-items: flex-end;
  padding: 7px 10px;
  transition: border-color .18s;
}
.twrap:focus-within { border-color: rgba(99,102,241,.5); }

textarea {
  flex: 1; background: none; border: none; outline: none;
  color: var(--text);
  font-family: 'Space Grotesk', sans-serif;
  font-size: .85rem; resize: none;
  max-height: 100px; min-height: 20px; line-height: 1.5;
}
textarea::placeholder { color: var(--muted); }

.sbtn {
  width: 36px; height: 36px;
  border-radius: 10px;
  background: linear-gradient(135deg, #6366f1, #a78bfa);
  border: none; color: #fff;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer; font-size: .9rem; flex-shrink: 0;
  box-shadow: 0 0 16px rgba(99,102,241,.4);
  transition: all .15s;
}
.sbtn:active { transform: scale(.9); }
.sbtn:disabled { opacity: .3; box-shadow: none; }

/* SETTINGS OVERLAY */
.overlay {
  position: fixed; inset: 0;
  background: rgba(0,0,0,.7);
  backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
  z-index: 100; display: none; align-items: flex-end;
}
.overlay.open { display: flex; animation: fi .18s ease; }

.panel {
  width: 100%; background: #0f1123;
  border: 1px solid var(--border2);
  border-bottom: none;
  border-radius: 22px 22px 0 0;
  padding: 16px 18px calc(var(--sb) + 18px);
  max-height: 80dvh; overflow-y: auto;
}
.ph {
  width: 36px; height: 4px;
  background: rgba(255,255,255,.12);
  border-radius: 2px; margin: 0 auto 16px;
}
.ptitle {
  font-size: 1.05rem; font-weight: 700;
  letter-spacing: -.01em; margin-bottom: 16px;
  color: #fff;
}
.sg { margin-bottom: 14px; }
.sl {
  font-size: .66rem; color: var(--muted2);
  font-weight: 600; letter-spacing: .09em;
  text-transform: uppercase; margin-bottom: 7px;
  font-family: 'JetBrains Mono', monospace;
}
.mgrid { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
.mopt {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 10px; padding: 9px 11px;
  cursor: pointer; transition: all .15s; text-align: center;
}
.mopt.on {
  border-color: rgba(99,102,241,.5);
  background: rgba(99,102,241,.12);
}
.mn { font-size: .76rem; font-weight: 600; color: var(--text); }
.md { font-size: .66rem; color: var(--muted2); margin-top: 1px; }
.savebtn {
  width: 100%; padding: 12px;
  background: linear-gradient(135deg, #6366f1, #a78bfa);
  border: none; border-radius: 12px; color: #fff;
  font-family: 'Space Grotesk', sans-serif;
  font-weight: 700; font-size: .9rem;
  cursor: pointer; margin-top: 4px;
  box-shadow: 0 0 20px rgba(99,102,241,.3);
}
.savebtn:active { opacity: .85; }
.clrbtn {
  width: 100%; padding: 10px;
  background: rgba(255,100,100,.06);
  border: 1px solid rgba(255,100,100,.15);
  border-radius: 12px; color: #f87171;
  font-family: 'Space Grotesk', sans-serif;
  font-size: .82rem; cursor: pointer; margin-top: 6px;
}
.anote {
  font-size: .68rem; color: var(--muted);
  margin-top: 8px; text-align: center;
  font-family: 'JetBrains Mono', monospace;
}

/* KEYSCREEN */
.keyscreen {
  position: fixed; inset: 0; background: var(--bg);
  z-index: 200;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center; padding: 28px;
}
.keyscreen.hidden { display: none; }
.ks-glow {
  width: 72px; height: 72px; border-radius: 22px;
  background: linear-gradient(135deg, #6366f1, #a78bfa);
  display: flex; align-items: center; justify-content: center;
  font-size: 2rem; margin-bottom: 18px;
  box-shadow: 0 0 50px rgba(99,102,241,.5), 0 0 100px rgba(99,102,241,.2);
}
.kscard {
  width: 100%; max-width: 340px;
  background: var(--card);
  border: 1px solid var(--border2);
  border-radius: 20px; padding: 22px;
}
.kscard h2 {
  font-size: 1.15rem; font-weight: 700;
  letter-spacing: -.02em; margin-bottom: 6px; color: #fff;
}
.kscard p {
  color: var(--muted2); font-size: .8rem;
  line-height: 1.55; margin-bottom: 16px;
}
.ksinp {
  width: 100%; background: var(--bg);
  border: 1.5px solid var(--border2);
  border-radius: 11px; padding: 11px 13px;
  color: var(--text);
  font-family: 'JetBrains Mono', monospace;
  font-size: .82rem; outline: none; margin-bottom: 9px;
  transition: border-color .18s;
}
.ksinp:focus { border-color: rgba(99,102,241,.6); }
.ksinp::placeholder { color: var(--muted); }
.ksbtn {
  width: 100%; padding: 12px;
  background: linear-gradient(135deg, #6366f1, #a78bfa);
  border: none; border-radius: 12px; color: #fff;
  font-family: 'Space Grotesk', sans-serif;
  font-weight: 700; font-size: .9rem; cursor: pointer;
  box-shadow: 0 0 20px rgba(99,102,241,.3);
}
.ksbtn:active { opacity: .85; }
.kslink {
  display: block; text-align: center;
  margin-top: 11px; font-size: .72rem; color: var(--muted2);
}
.kslink a { color: #a5b4fc; text-decoration: none; }
.kserr {
  font-size: .73rem; color: #f87171;
  margin-bottom: 8px; display: none;
  font-family: 'JetBrains Mono', monospace;
}
.kserr.show { display: block; }

@keyframes fu { from { opacity:0; transform: translateY(8px); } to { opacity:1; transform: translateY(0); } }
@keyframes fi { from { opacity:0; } to { opacity:1; } }
@keyframes ty {
  0%,60%,100% { transform: translateY(0); opacity: .4; }
  30% { transform: translateY(-5px); opacity: 1; }
}
</style>
</head>
<body>

<!-- KEYSCREEN -->
<div class="keyscreen hidden" id="keyscreen">
  <div class="ks-glow">üîë</div>
  <div class="kscard">
    <h2>API –∫–ª—é—á OpenAI</h2>
    <p>–ö–ª—é—á —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–≤–æ—ë–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ. –í –∫–æ–¥–µ –µ–≥–æ –Ω–µ—Ç ‚Äî –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –Ω–∞ GitHub.</p>
    <div class="kserr" id="kserr">‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á –∏–ª–∏ –Ω–µ—Ç —Å–µ—Ç–∏</div>
    <input class="ksinp" id="ksinp" type="password" placeholder="sk-proj-..." autocomplete="off" spellcheck="false">
    <button class="ksbtn" onclick="saveKey()" disabled="">–ü—Ä–æ–≤–µ—Ä—è–µ–º...</button>
    <div class="kslink">–ù–µ—Ç –∫–ª—é—á–∞? <a href="https://platform.openai.com/api-keys" target="_blank">platform.openai.com ‚Üí</a></div>
  </div>
</div>

<!-- HEADER -->
<div class="hdr">
  <div class="logo">
    <div class="logo-icon">üéì</div>
    <div class="logo-text">StudyAI <span>by GPT-5.2</span></div>
  </div>
  <div class="hbtn" id="settingsBtn">‚öô</div>
</div>

<!-- TABS -->
<div class="tabs-wrap">
  <div class="tabs">
    <div class="tab on" data-s="gen"><span class="tab-dot"></span>–û–±—â–∏–π —á–∞—Ç</div>
    <div class="tab" data-s="eng"><span class="tab-dot"></span>–ê–Ω–≥–ª–∏–π—Å–∫–∏–π</div>
    <div class="tab" data-s="math"><span class="tab-dot"></span>–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</div>
    <div class="tab" data-s="bp"><span class="tab-dot"></span>–ë–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å—ã</div>
    <div class="tab" data-s="ru"><span class="tab-dot"></span>–†—É—Å—Å–∫–∏–π —è–∑—ã–∫</div>
    <div class="tab" data-s="macro"><span class="tab-dot"></span>–ú–∞–∫—Ä–æ—ç–∫–æ–Ω–æ–º–∏–∫–∞</div>
  </div>
</div>

<div class="statusbar" id="statusbar">‚úÖ –ö–ª—é—á —Å–æ—Ö—Ä–∞–Ω—ë–Ω</div>

<!-- MESSAGES -->
<div class="msgs" id="msgs">
  <div class="welcome" id="welcome" style="display: none;">
    <div class="welcome-hero">
      <div class="glow">üéì</div>
      <h2>–í—ã–±–µ—Ä–∏ –ø—Ä–µ–¥–º–µ—Ç –∏ –∑–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å</h2>
      <p>–ü—Ä–∏–∫—Ä–µ–ø–∏ —Ñ–æ—Ç–æ –∑–∞–¥–∞–Ω–∏—è –∏–ª–∏ –Ω–∞–ø–∏—à–∏ ‚Äî —Ä–µ—à—É –ø–æ—à–∞–≥–æ–≤–æ</p>
    </div>
    <div class="qgrid">
      <div class="qcard" data-c="eng" onclick="setTabAndSend(&#39;eng&#39;,&#39;–†–µ—à–∏ Workbook Unit 8 Lesson A ‚Äî –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è –ø–æ wishes –∏ second conditional&#39;)">
        <div class="qcard-ico">üìó</div>
        <div class="qcard-title">Workbook Unit 8</div>
        <div class="qcard-sub">Wishes &amp; Conditionals</div>
      </div>
      <div class="qcard" data-c="math" onclick="setTabAndSend(&#39;math&#39;,&#39;–í—ã—á–∏—Å–ª–∏ –ø—Ä–µ–¥–µ–ª: lim –ø—Ä–∏ x‚Üí‚àû –æ—Ç (x¬≤‚àí5x+11)/(3x¬≤+x+4). –û–±—ä—è—Å–Ω–∏ –∫–∞–∂–¥—ã–π —à–∞–≥.&#39;)">
        <div class="qcard-ico">üìê</div>
        <div class="qcard-title">–ü—Ä–µ–¥–µ–ª —Ñ—É–Ω–∫—Ü–∏–∏</div>
        <div class="qcard-sub">–ù–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç—å ‚àû/‚àû</div>
      </div>
      <div class="qcard" data-c="macro" onclick="setTabAndSend(&#39;macro&#39;,&#39;–†–µ—à–∏ –∑–∞–¥–∞—á—É 1: C=500, I=100, G –ø—Ä–µ–≤—ã—Å–∏–ª–∏ —á–∏—Å—Ç—ã–µ –Ω–∞–ª–æ–≥–∏ –Ω–∞ 50, –Ω–∞–ª–æ–≥–∏ 30% –æ—Ç Y, —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä—Ç—ã —Ç—Ä–µ—Ç—å –Ω–∞–ª–æ–≥–æ–≤, NX=30. –ù–∞–π–¥–∏ Y –∏ G.&#39;)">
        <div class="qcard-ico">üìä</div>
        <div class="qcard-title">–ú–∞–∫—Ä–æ—ç–∫–æ–Ω–æ–º–∏–∫–∞</div>
        <div class="qcard-sub">–ó–∞–¥–∞—á–∞ –Ω–∞ –∫—Ä—É–≥–æ–æ–±–æ—Ä–æ—Ç</div>
      </div>
      <div class="qcard" data-c="bp" onclick="setTabAndSend(&#39;bp&#39;,&#39;–û–±—ä—è—Å–Ω–∏ 5 —Ç–∏–ø–æ–≤ —Å—Ç—Ä–µ–ª–æ–∫ IDEF0 —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏. –ù–∞—Ä–∏—Å—É–π —Å—Ö–µ–º—É.&#39;)">
        <div class="qcard-ico">üóÇ</div>
        <div class="qcard-title">IDEF0</div>
        <div class="qcard-sub">5 —Ç–∏–ø–æ–≤ —Å—Ç—Ä–µ–ª–æ–∫</div>
      </div>
    </div>
  </div>
<div class="msg usr"><div class="av usrav">üë§</div><div class="bub usrbub"><div>—Ä—Ä</div></div></div><div class="msg "><div class="av aiav">AI</div><div class="bub aibub"><div class="sbadge sb-gen">‚óè –û–±—â–∏–π —á–∞—Ç</div><div>–ü–æ—Ö–æ–∂–µ, –≤—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ ¬´—Ä—Ä¬ª —Å–ª—É—á–∞–π–Ω–æ.<br><br>–ù–∞–ø–∏—à–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω—É–∂–Ω–æ: –≤–æ–ø—Ä–æ—Å, —Ç–µ–º—É –∏–ª–∏ –∑–∞–¥–∞—á—É (–º–æ–∂–Ω–æ —Ñ–æ—Ç–æ/—Å–∫—Ä–∏–Ω).</div></div></div></div>

<div class="prevs" id="prevs"></div>

<!-- INPUT -->
<div class="inp-area">
  <div class="inp-row">
    <div style="display:flex;gap:4px;flex-shrink:0">
      <label class="abtn" for="fi1">üñº</label>
      <input type="file" id="fi1" accept="image/*" multiple="" style="display:none">
      <label class="abtn" for="fi2">üì∑</label>
      <input type="file" id="fi2" accept="image/*" capture="environment" style="display:none">
    </div>
    <div class="twrap">
      <textarea id="ta" placeholder="–ù–∞–ø–∏—à–∏ –∑–∞–¥–∞–Ω–∏–µ –∏–ª–∏ –ø—Ä–∏–∫—Ä–µ–ø–∏ —Ñ–æ—Ç–æ..." rows="1" maxlength="8000" style="height: auto;"></textarea>
    </div>
    <button class="sbtn" id="sbtn" onclick="send()">‚ñ∂</button>
  </div>
</div>

<!-- SETTINGS -->
<div class="overlay" id="ov" onclick="ovClose(event)">
  <div class="panel">
    <div class="ph"></div>
    <div class="ptitle">‚öô –ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
    <div class="sg">
      <div class="sl">–ú–æ–¥–µ–ª—å</div>
      <div class="mgrid">
        <div class="mopt on" data-m="gpt-5.2" onclick="pickModel(this)">
          <div class="mn">GPT-5.2</div><div class="md">–ù–æ–≤–µ–π—à–∞—è, Dec 2025</div>
        </div>
        <div class="mopt" data-m="gpt-5.2-thinking" onclick="pickModel(this)">
          <div class="mn">GPT-5.2 Thinking</div><div class="md">–°–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏</div>
        </div>
        <div class="mopt" data-m="gpt-4.1" onclick="pickModel(this)">
          <div class="mn">GPT-4.1</div><div class="md">–ë—ã—Å—Ç—Ä–∞—è, –∫–æ–¥–∏–Ω–≥</div>
        </div>
        <div class="mopt" data-m="gpt-4o" onclick="pickModel(this)">
          <div class="mn">GPT-4o</div><div class="md">–í–∏–¥–∏—Ç —Ñ–æ—Ç–æ</div>
        </div>
      </div>
    </div>
    <button class="savebtn" onclick="saveSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <button class="clrbtn" onclick="clearChat()">üóë –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞</button>
    <button class="clrbtn" style="color:#fbbf24;border-color:rgba(251,191,36,.18);margin-top:5px" onclick="changeKey()">üîë –°–º–µ–Ω–∏—Ç—å API –∫–ª—é—á</button>
    <div class="anote">–ö–ª—é—á —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ ¬∑ –í –∫–æ–¥–µ –∫–ª—é—á–∞ –Ω–µ—Ç</div>
  </div>
</div>

<script>
let API_KEY = localStorage.getItem('api_key') || '';
let msgs = [], imgs = [], subject = 'gen', busy = false;
let model = localStorage.getItem('model') || 'gpt-5.2';

// ========================================================
//  KNOWLEDGE BASE ‚Äî MACROECONOMICS (from presentations)
// ========================================================

const MACRO_KB = `
=== –ú–ê–ö–†–û–≠–ö–û–ù–û–ú–ò–ö–ê ‚Äî –ü–û–õ–ù–ê–Ø –ë–ê–ó–ê –ó–ù–ê–ù–ò–ô (–¢–µ–º—ã 5-8) ===

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
–¢–ï–ú–ê 5.1: –≠–ö–û–ù–û–ú–ò–ß–ï–°–ö–ò–ô –ö–†–£–ì–û–û–ë–û–†–û–¢ –ò –¢–û–ñ–î–ï–°–¢–í–ê
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

–ü–†–ï–î–ú–ï–¢ –ú–ê–ö–†–û–≠–ö–û–ù–û–ú–ò–ö–ò:
–ú–∞–∫—Ä–æ—ç–∫–æ–Ω–æ–º–∏–∫–∞ –∏–∑—É—á–∞–µ—Ç: 1) –û–±—ä–µ–º—ã –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞; 2) –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π —Ä–æ—Å—Ç, –µ–≥–æ —Ñ–∞–∫—Ç–æ—Ä—ã –∏ –ø—Ä–∏—á–∏–Ω—ã; 3) –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π —Ü–∏–∫–ª –∏ –µ–≥–æ –ø—Ä–∏—á–∏–Ω—ã; 4) –ó–∞–Ω—è—Ç–æ—Å—Ç—å –∏ –±–µ–∑—Ä–∞–±–æ—Ç–∏—Ü—É; 5) –û–±—â–∏–π —É—Ä–æ–≤–µ–Ω—å —Ü–µ–Ω –∏ –∏–Ω—Ñ–ª—è—Ü–∏—é; 6) –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π –±—é–¥–∂–µ—Ç; 7) –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—É—é —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫—É—é –ø–æ–ª–∏—Ç–∏–∫—É.

–ú–ï–¢–û–î –ú–ê–ö–†–û–≠–ö–û–ù–û–ú–ò–ö–ò:
–û–ø–µ—Ä–∏—Ä—É–µ—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ (–≤—Å–µ —Å—É–±—ä–µ–∫—Ç—ã, –ø—Ä–æ—Ü–µ—Å—Å—ã, —è–≤–ª–µ–Ω–∏—è –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –ø–æ –ø—Ä–∏–∑–Ω–∞–∫–∞–º –∏ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç—Å—è –≤ —Å–æ–≤–æ–∫—É–ø–Ω–æ—Å—Ç–∏). –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞: –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–µ–π. –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏: –ø–æ—Ç–µ—Ä—è —á–∞—Å—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, —É–ø—Ä–æ—â–µ–Ω–∏–µ.

–ú–ê–ö–†–û–≠–ö–û–ù–û–ú–ò–ß–ï–°–ö–û–ï –ú–û–î–ï–õ–ò–†–û–í–ê–ù–ò–ï ‚Äî —Ñ–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —è–≤–ª–µ–Ω–∏–π –≤ –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π —ç–∫–æ–Ω–æ–º–∏–∫–µ —Å —Ü–µ–ª—å—é –≤—ã—è–≤–ª–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
–≠–∫–∑–æ–≥–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ‚Äî —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –≤–Ω–µ –º–æ–¥–µ–ª–∏ (–∞–≤—Ç–æ–Ω–æ–º–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã).
–≠–Ω–¥–æ–≥–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ‚Äî —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–µ–ª–∏ (–∑–∞–≤–∏—Å–∏–º—ã–µ, –æ—Ü–µ–Ω–∏–≤–∞—é—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω–æ).

–ü–û–¢–û–ö vs –ó–ê–ü–ê–°:
–ü–æ—Ç–æ–∫ ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É—é—â–∞—è –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å (–¥–æ—Ö–æ–¥ = –ø–æ—Ç–æ–∫, –∏–∑–º–µ—Ä—è–µ—Ç—Å—è –≤ —Ä—É–±–ª—è—Ö/–ø–µ—Ä–∏–æ–¥).
–ó–∞–ø–∞—Å ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–µ–≥–æ-–ª–∏–±–æ, —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç (–∏–º—É—â–µ—Å—Ç–≤–æ = –∑–∞–ø–∞—Å, –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è –≤ —Ä—É–±–ª—è—Ö –Ω–∞ –¥–∞—Ç—É).

–ú–ê–ö–†–û–≠–ö–û–ù–û–ú–ò–ß–ï–°–ö–ò–ï –°–£–ë–™–ï–ö–¢–´: –î–æ–º–∞—à–Ω–∏–µ —Ö–æ–∑—è–π—Å—Ç–≤–∞, –§–∏—Ä–º—ã, –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–æ, –ó–∞–≥—Ä–∞–Ω–∏—Ü–∞.

–ë–ê–ó–û–í–ê–Ø –ú–û–î–ï–õ–¨ –ö–†–£–ì–û–û–ë–û–†–û–¢–ê:
–†–∞—Å—Ö–æ–¥—ã –î–• ‚Üí –¢–æ–≤–∞—Ä–Ω—ã–π —Ä—ã–Ω–æ–∫ ‚Üí –î–æ—Ö–æ–¥ –§–∏—Ä–º; –§–∏—Ä–º—ã ‚Üí –†—ã–Ω–æ–∫ —Ä–µ—Å—É—Ä—Å–æ–≤ ‚Üí –î–• (–ø–ª–∞—Ç–∞ –∑–∞ —Ä–µ—Å—É—Ä—Å—ã = –ù–î).
–û—Å–Ω–æ–≤–Ω–æ–µ —Ç–æ–∂–¥–µ—Å—Ç–≤–æ: Y = E (—Å–æ–≤–æ–∫—É–ø–Ω—ã–π –≤—ã–ø—É—Å–∫ = —Å–æ–≤–æ–∫—É–ø–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã).

–£–¢–ï–ß–ö–ò –ò –ò–ù–™–ï–ö–¶–ò–ò:
–£—Ç–µ—á–∫–∏ ‚Äî —á–∞—Å—Ç—å –ù–î, –Ω–µ —Ä–∞—Å—Ö–æ–¥—É–µ–º–∞—è –Ω–∞ –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–º —Ä—ã–Ω–∫–µ. –ò–Ω—ä–µ–∫—Ü–∏–∏ ‚Äî –ø–æ—Ç–æ–∫–∏, –≤–ª–∏–≤–∞—é—â–∏–µ—Å—è –≤ —ç–∫–æ–Ω–æ–º–∏–∫—É.
–ú–æ–¥–µ–ª—å —Å –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏—è–º–∏: Y = C + S ‚Üí E = C + I ‚Üí S = I (—Ç–æ–∂–¥–µ—Å—Ç–≤–æ —É—Ç–µ—á–µ–∫ –∏ –∏–Ω—ä–µ–∫—Ü–∏–π).

–ú–û–î–ï–õ–¨ –° –ì–û–°–£–î–ê–†–°–¢–í–û–ú:
Y = C + I + G (–º–∞–∫—Ä–æ—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–µ —Ç–æ–∂–¥–µ—Å—Ç–≤–æ).
–ß–∏—Å—Ç—ã–µ –Ω–∞–ª–æ–≥–∏ T = –ù–∞–ª–æ–≥–∏ ‚àí –¢—Ä–∞–Ω—Å—Ñ–µ—Ä—Ç—ã.
–£—Ç–µ—á–∫–∏ = S + T; –ò–Ω—ä–µ–∫—Ü–∏–∏ = I + G ‚Üí S + T = I + G.
–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–±–µ—Ä–µ–∂–µ–Ω–∏—è: SN = S + B, –≥–¥–µ B = (T ‚àí G) = —Å–∞–ª—å–¥–æ –≥–æ—Å–±—é–¥–∂–µ—Ç–∞.
SN = S + (T ‚àí G) = I.

–ú–û–î–ï–õ–¨ –° –ó–ê–ì–†–ê–ù–ò–¶–ï–ô (–û–¢–ö–†–´–¢–ê–Ø –≠–ö–û–ù–û–ú–ò–ö–ê):
–£—Ç–µ—á–∫–∏ = S + T + IM (–∏–º–ø–æ—Ä—Ç). –ò–Ω—ä–µ–∫—Ü–∏–∏ = I + G + EX (—ç–∫—Å–ø–æ—Ä—Ç).
–û—Å–Ω–æ–≤–Ω–æ–µ —Ç–æ–∂–¥–µ—Å—Ç–≤–æ: Y = C + I + G + NX, –≥–¥–µ NX = EX ‚àí IM (—á–∏—Å—Ç—ã–π —ç–∫—Å–ø–æ—Ä—Ç).
S + T + IM = I + G + EX ‚Üí S + T = I + G + NX.
–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–±–µ—Ä–µ–∂–µ–Ω–∏—è: SN = I + NX.

–ê–õ–ì–û–†–ò–¢–ú –†–ï–®–ï–ù–ò–Ø –ó–ê–î–ê–ß –ù–ê –ö–†–£–ì–û–û–ë–û–†–û–¢:
1. –ó–∞–ø–∏—Å–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ —Ç–æ–∂–¥–µ—Å—Ç–≤–æ: Y = C + I + G + NX
2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤—Å–µ –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –∏ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ
3. –ù–∞–π—Ç–∏ —á–∏—Å—Ç—ã–µ –Ω–∞–ª–æ–≥–∏ T = t¬∑Y ‚àí Tr (–µ—Å–ª–∏ –Ω–∞–ª–æ–≥–∏ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ)
4. –ù–∞–π—Ç–∏ G –∏–∑ —É—Å–ª–æ–≤–∏—è (G ‚àí T = –¥–µ—Ñ–∏—Ü–∏—Ç –∏–ª–∏ T ‚àí G = –ø—Ä–æ—Ñ–∏—Ü–∏—Ç)
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∂–¥–µ—Å—Ç–≤–æ —É—Ç–µ—á–µ–∫ –∏ –∏–Ω—ä–µ–∫—Ü–∏–π: S + T + IM = I + G + EX
6. –ß–∞—Å—Ç–Ω—ã–µ —Å–±–µ—Ä–µ–∂–µ–Ω–∏—è: S = Y ‚àí C ‚àí T (–¥–ª—è –æ—Ç–∫—Ä—ã—Ç–æ–π —ç–∫–æ–Ω–æ–º–∏–∫–∏ —Å –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–æ–º)
7. –ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–±–µ—Ä–µ–∂–µ–Ω–∏—è: SN = S + (T ‚àí G) = Y ‚àí C ‚àí G

–§–û–†–ú–£–õ–´:
Y = C + I + G + NX
T (—á–∏—Å—Ç—ã–µ) = –ù–∞–ª–æ–≥–æ–≤—ã–µ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è ‚àí –¢—Ä–∞–Ω—Å—Ñ–µ—Ä—Ç—ã
B = T ‚àí G (—Å–∞–ª—å–¥–æ –±—é–¥–∂–µ—Ç–∞, –µ—Å–ª–∏ >0 ‚Äî –ø—Ä–æ—Ñ–∏—Ü–∏—Ç, <0 ‚Äî –¥–µ—Ñ–∏—Ü–∏—Ç)
S (—á–∞—Å—Ç–Ω—ã–µ) = Y ‚àí C ‚àí T = Y ‚àí C ‚àí (–ù–∞–ª–æ–≥–∏ ‚àí –¢—Ä–∞–Ω—Å—Ñ–µ—Ä—Ç—ã)
SN (–Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ) = S + B = S + (T ‚àí G) = Y ‚àí C ‚àí G
NX = EX ‚àí IM (—á–∏—Å—Ç—ã–π —ç–∫—Å–ø–æ—Ä—Ç)
–£—Ç–µ—á–∫–∏ = S + T + IM
–ò–Ω—ä–µ–∫—Ü–∏–∏ = I + G + EX
–í —Ä–∞–≤–Ω–æ–≤–µ—Å–∏–∏: –£—Ç–µ—á–∫–∏ = –ò–Ω—ä–µ–∫—Ü–∏–∏

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
–¢–ï–ú–ê 5.2: –ë–ï–ó–†–ê–ë–û–¢–ò–¶–ê, –ò–ù–§–õ–Ø–¶–ò–Ø, –¶–ò–ö–õ–´
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

–≠–ö–û–ù–û–ú–ò–ß–ï–°–ö–ò–ï –¶–ò–ö–õ–´:
–¶–∏–∫–ª—ã –ö–∏—Ç—á–∏–Ω–∞ (2-4 –≥–æ–¥–∞) ‚Äî –∫–æ–ª–µ–±–∞–Ω–∏—è –¢–ú–ó –∏ –¥–µ–Ω–µ–∂–Ω–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è.
–¶–∏–∫–ª—ã –ñ—É–≥–ª—è—Ä–∞ (7-12 –ª–µ—Ç) ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–∞–ø–∏—Ç–∞–ª–∞, ¬´–±–∏–∑–Ω–µ—Å-—Ü–∏–∫–ª—ã¬ª.
–¶–∏–∫–ª—ã –ö—É–∑–Ω–µ—Ü–∞ (18-25 –ª–µ—Ç) ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∂–∏–ª–∏—â –∏ —Å–æ–æ—Ä—É–∂–µ–Ω–∏–π.
–¶–∏–∫–ª—ã –ö–æ–Ω–¥—Ä–∞—Ç—å–µ–≤–∞ (40-60 –ª–µ—Ç) ‚Äî ¬´–¥–ª–∏–Ω–Ω—ã–µ –≤–æ–ª–Ω—ã¬ª, —Å–º–µ–Ω–∞ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö —Å–ø–æ—Å–æ–±–æ–≤ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞.

–§–ê–ó–´ –≠–ö–û–ù–û–ú–ò–ß–ï–°–ö–û–ì–û –¶–ò–ö–õ–ê:
1. –ö—Ä–∏–∑–∏—Å (—Ä–µ—Ü–µ—Å—Å–∏—è) ‚Äî –ø–µ—Ä–µ–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ, —Ä–æ—Å—Ç –∑–∞–ø–∞—Å–æ–≤, –ø–∞–¥–µ–Ω–∏–µ —Ü–µ–Ω –∏ –ø—Ä–∏–±—ã–ª–∏, —Ä–æ—Å—Ç –±–µ–∑—Ä–∞–±–æ—Ç–∏—Ü—ã.
2. –î–µ–ø—Ä–µ—Å—Å–∏—è ‚Äî –∑–∞—Å—Ç–æ–π, –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ –Ω–µ –ø–∞–¥–∞–µ—Ç –∏ –Ω–µ —Ä–∞—Å—Ç—ë—Ç, –Ω–∏–∑–∫–∞—è —Å—Ç–∞–≤–∫–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–∞, –Ω–µ—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π.
3. –û–∂–∏–≤–ª–µ–Ω–∏–µ ‚Äî —Ä–æ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞, —Å–Ω–∏–∂–µ–Ω–∏–µ –±–µ–∑—Ä–∞–±–æ—Ç–∏—Ü—ã, –∞–∫—Ç–∏–≤–∏–∑–∞—Ü–∏—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π, —Ä–æ—Å—Ç —Ü–µ–Ω.
4. –ü–æ–¥—ä—ë–º (—ç–∫—Å–ø–∞–Ω—Å–∏—è) ‚Äî –±—ã—Å—Ç—Ä—ã–π —Ä–æ—Å—Ç –í–í–ü, –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π, —Ä–∞—Å—Ö–æ–¥–æ–≤. ¬´–ë—É–º¬ª ‚Üí –ø–µ—Ä–µ–≥—Ä–µ–≤ ‚Üí –Ω–æ–≤—ã–π –∫—Ä–∏–∑–∏—Å.

–ë–ï–ó–†–ê–ë–û–¢–ò–¶–ê ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä—ã–Ω–∫–∞ —Ç—Ä—É–¥–∞, –∫–æ–≥–¥–∞ —á–∞—Å—Ç—å —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –Ω–∞—Å–µ–ª–µ–Ω–∏—è –Ω–µ –∑–∞–Ω—è—Ç–∞.
–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –±–µ–∑—Ä–∞–±–æ—Ç–∏—Ü—ã: 4-5%.
–í–∏–¥—ã: —Ñ—Ä–∏–∫—Ü–∏–æ–Ω–Ω–∞—è, —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞—è (= –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∞—è), —Ü–∏–∫–ª–∏—á–µ—Å–∫–∞—è.
–†–∞–∑—Ä—ã–≤ –í–í–ü: –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –í–í–ü –æ—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–≥–æ.

–ò–ù–î–ï–ö–°–´ –¶–ï–ù –ò –ò–ù–§–õ–Ø–¶–ò–Ø:
–ò–Ω—Ñ–ª—è—Ü–∏—è ‚Äî —É—Å—Ç–æ–π—á–∏–≤—ã–π —Ä–æ—Å—Ç –æ–±—â–µ–≥–æ —É—Ä–æ–≤–Ω—è —Ü–µ–Ω.
–ò–Ω–¥–µ–∫—Å –õ–∞—Å–ø–µ–π—Ä–µ—Å–∞ (–ò–ü–¶): Œ£P1¬∑Q0 / Œ£P0¬∑Q0 √ó 100%.
–ò–Ω–¥–µ–∫—Å –ü–∞–∞—à–µ (–¥–µ—Ñ–ª—è—Ç–æ—Ä –í–í–ü): Œ£P1¬∑Q1 / Œ£P0¬∑Q1 √ó 100%.

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
–¢–ï–ú–ê 6.1: –ú–û–î–ï–õ–¨ AD-AS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

–°–û–í–û–ö–£–ü–ù–´–ô –°–ü–†–û–° (AD) ‚Äî —Ä–µ–∞–ª—å–Ω—ã–π –æ–±—ä—ë–º –∫–æ–Ω–µ—á–Ω–æ–π –ø—Ä–æ–¥—É–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–π —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –∞–≥–µ–Ω—Ç—ã –≥–æ—Ç–æ–≤—ã –ø—Ä–∏–æ–±—Ä–µ—Ç–∞—Ç—å –ø—Ä–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —É—Ä–æ–≤–Ω—è—Ö —Ü–µ–Ω.
AD = C + NI + G + NX

–ö–†–ò–í–ê–Ø AD ‚Äî –æ–±—Ä–∞—Ç–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –º–µ–∂–¥—É –æ–±—ä—ë–º–æ–º –≤—ã–ø—É—Å–∫–∞ –∏ —É—Ä–æ–≤–Ω–µ–º —Ü–µ–Ω.
–≠—Ñ—Ñ–µ–∫—Ç—ã, –æ–±—ä—è—Å–Ω—è—é—â–∏–µ –Ω–∞–∫–ª–æ–Ω AD:
1. –≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫: P‚Üë ‚Üí r‚Üë ‚Üí I‚Üì ‚Üí AD‚Üì.
2. –≠—Ñ—Ñ–µ–∫—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–∞—Å—Å–æ–≤—ã—Ö –æ—Å—Ç–∞—Ç–∫–æ–≤ (–±–æ–≥–∞—Ç—Å—Ç–≤–∞): P‚Üë ‚Üí —Ä–µ–∞–ª—å–Ω–æ–µ –±–æ–≥–∞—Ç—Å—Ç–≤–æ‚Üì ‚Üí C‚Üì ‚Üí AD‚Üì.
3. –≠—Ñ—Ñ–µ–∫—Ç –∏–º–ø–æ—Ä—Ç–Ω—ã—Ö –∑–∞–∫—É–ø–æ–∫: P‚Üë ‚Üí –∏–º–ø–æ—Ä—Ç‚Üë ‚Üí NX‚Üì ‚Üí AD‚Üì.

–ù–µ—Ü–µ–Ω–æ–≤—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã AD (—Å–¥–≤–∏–≥–∞—é—Ç –∫—Ä–∏–≤—É—é): –æ–∂–∏–¥–∞–Ω–∏—è, –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≥–æ—Å—Ä–∞—Å—Ö–æ–¥–æ–≤, –Ω–∞–ª–æ–≥–æ–≤, –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π.

–°–û–í–û–ö–£–ü–ù–û–ï –ü–†–ï–î–õ–û–ñ–ï–ù–ò–ï (AS) ‚Äî –æ–±—ä—ë–º –∫–æ–Ω–µ—á–Ω–æ–π –ø—Ä–æ–¥—É–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–∏ –ø–ª–∞–Ω–∏—Ä—É—é—Ç –ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏.
–í –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–º –ø–µ—Ä–∏–æ–¥–µ: AS ‚Äî –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è (—ç–∫–æ–Ω–æ–º–∏–∫–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–æ–ª–Ω–æ–π –∑–∞–Ω—è—Ç–æ—Å—Ç–∏, —Ü–µ–Ω—ã –≥–∏–±–∫–∏–µ).
–í –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–º –ø–µ—Ä–∏–æ–¥–µ: AS ‚Äî –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è (–∫–µ–π–Ω—Å–∏–∞–Ω—Å–∫–∏–π) –∏–ª–∏ –≤–æ—Å—Ö–æ–¥—è—â–∞—è –ª–∏–Ω–∏—è.

–ù–û–ú–ò–ù–ê–õ–¨–ù–´–ï –ò –†–ï–ê–õ–¨–ù–´–ï –í–ï–õ–ò–ß–ò–ù–´:
–ù–æ–º–∏–Ω–∞–ª—å–Ω–∞—è % —Å—Ç–∞–≤–∫–∞ ‚Äî —Å–ª–æ–∂–∏–ª–∞—Å—å –Ω–∞ —Ä—ã–Ω–∫–µ.
–†–µ–∞–ª—å–Ω–∞—è % —Å—Ç–∞–≤–∫–∞ = –Ω–æ–º–∏–Ω–∞–ª—å–Ω–∞—è ‚àí —Ç–µ–º–ø –∏–Ω—Ñ–ª—è—Ü–∏–∏.
–†–µ–∞–ª—å–Ω—ã–µ –∫–∞—Å—Å–æ–≤—ã–µ –æ—Å—Ç–∞—Ç–∫–∏ = –Ω–æ–º–∏–Ω–∞–ª—å–Ω–∞—è –¥–µ–Ω–µ–∂–Ω–∞—è –º–∞—Å—Å–∞ / —É—Ä–æ–≤–µ–Ω—å —Ü–µ–Ω.

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
–¢–ï–ú–ê 6.2: –ö–ï–ô–ù–°–ò–ê–ù–°–ö–ê–Ø –ú–û–î–ï–õ–¨ ¬´–î–û–•–û–î–´-–†–ê–°–•–û–î–´¬ª
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

–ü–†–ï–î–ü–û–°–´–õ–ö–ò:
- –í–µ–¥—É—â–∞—è —Ä–æ–ª—å ‚Äî —Å–æ–≤–æ–∫—É–ø–Ω—ã–π —Å–ø—Ä–æ—Å.
- –£—Ä–æ–≤–µ–Ω—å —Ü–µ–Ω —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω.
–£—Å–ª–æ–≤–∏—è —Ä–∞–≤–Ω–æ–≤–µ—Å–∏—è –∑–∞–∫—Ä—ã—Ç–æ–π —ç–∫–æ–Ω–æ–º–∏–∫–∏ –±–µ–∑ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–∞: Y = C + I; S = I.

–û–°–ù–û–í–ù–û–ô –ü–°–ò–•–û–õ–û–ì–ò–ß–ï–°–ö–ò–ô –ó–ê–ö–û–ù –ö–ï–ô–ù–°–ê:
–ü—Ä–∏ —Ä–æ—Å—Ç–µ –¥–æ—Ö–æ–¥–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ —Ç—Ä–∞—Ç—è—Ç –Ω–∞ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —á–∞—Å—Ç—å, –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî —Å–±–µ—Ä–µ–≥–∞—é—Ç.
MPC = ŒîC/ŒîY ‚Äî –ø—Ä–µ–¥–µ–ª—å–Ω–∞—è —Å–∫–ª–æ–Ω–Ω–æ—Å—Ç—å –∫ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—é.
MPS = ŒîS/ŒîY ‚Äî –ø—Ä–µ–¥–µ–ª—å–Ω–∞—è —Å–∫–ª–æ–Ω–Ω–æ—Å—Ç—å –∫ —Å–±–µ—Ä–µ–∂–µ–Ω–∏—é.
MPC + MPS = 1.

–ü–û–¢–†–ï–ë–ò–¢–ï–õ–¨–°–ö–ê–Ø –§–£–ù–ö–¶–ò–Ø: C = C‚ÇÄ + MPC¬∑Y (C‚ÇÄ ‚Äî –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ).
–§–£–ù–ö–¶–ò–Ø –°–ë–ï–†–ï–ñ–ï–ù–ò–ô: S = ‚àíC‚ÇÄ + MPS¬∑Y.

–ò–ù–í–ï–°–¢–ò–¶–ò–ò –≤ –º–æ–¥–µ–ª–∏ –ö–µ–π–Ω—Å–∞ ‚Äî –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–µ (–Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç Y).

–†–ê–í–ù–û–í–ï–°–ù–´–ô –û–ë–™–Å–ú –í–´–ü–£–°–ö–ê:
Y = C + I ‚Üí Y = C‚ÇÄ + MPC¬∑Y + I ‚Üí Y(1 ‚àí MPC) = C‚ÇÄ + I ‚Üí Y = (1/(1‚àíMPC))¬∑(C‚ÇÄ + I).

–ü—Ä–∏–º–µ—Ä: C = 200 + 0,8Y; I = 120. Y = 200 + 0,8Y + 120 ‚Üí 0,2Y = 320 ‚Üí Y = 1600.

–ú–£–õ–¨–¢–ò–ü–õ–ò–ö–ê–¢–û–†: kE = 1/(1‚àíMPC) = 1/MPS.
ŒîY = kE ¬∑ ŒîI (–∏–ª–∏ ŒîG, –∏–ª–∏ ŒîC‚ÇÄ).
–ü—Ä–∏–º–µ—Ä: C = 50+0,8Y; I‚ÇÅ=100; I‚ÇÇ=150; ŒîI=50. kE=1/(1‚àí0,8)=5. ŒîY=5√ó50=250. Y‚ÇÅ=(50+100)/0,2=750. Y‚ÇÇ=1000.

–ò–ù–§–õ–Ø–¶–ò–û–ù–ù–´–ô –†–ê–ó–†–´–í: YE > Y–ü–ó (—Å–ø—Ä–æ—Å –∏–∑–±—ã—Ç–æ—á–µ–Ω, –Ω—É–∂–Ω–æ —Å–æ–∫—Ä–∞—Ç–∏—Ç—å —Ä–∞—Å—Ö–æ–¥—ã).
–†–ê–ó–†–´–í –ë–ï–ó–†–ê–ë–û–¢–ò–¶–´: YE < Y–ü–ó (—Å–ø—Ä–æ—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω, –Ω—É–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å —Ä–∞—Å—Ö–æ–¥—ã).

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
–¢–ï–ú–ê 7: –ë–Æ–î–ñ–ï–¢–ù–û-–ù–ê–õ–û–ì–û–í–ê–Ø –ü–û–õ–ò–¢–ò–ö–ê
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

–°–¢–ê–ë–ò–õ–ò–ó–ê–¶–ò–û–ù–ù–ê–Ø –ü–û–õ–ò–¢–ò–ö–ê ‚Äî –∫–æ–º–ø–ª–µ–∫—Å –º–µ—Ä –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–æ–ª–Ω–æ–π –∑–∞–Ω—è—Ç–æ—Å—Ç–∏ –∏ —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ —Ü–∏–∫–ª–∞.
¬´–ú–∞–≥–∏—á–µ—Å–∫–∏–π —á–µ—Ç—ã—Ä—ë—Ö—É–≥–æ–ª—å–Ω–∏–∫¬ª —Ü–µ–ª–µ–π: –ü–æ–ª–Ω–∞—è –∑–∞–Ω—è—Ç–æ—Å—Ç—å + –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ü–µ–Ω + –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π —Ä–æ—Å—Ç + –†–∞–≤–Ω–æ–≤–µ—Å–∏–µ –ø–ª–∞—Ç—ë–∂–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞.

–§–ò–°–ö–ê–õ–¨–ù–ê–Ø –ü–û–õ–ò–¢–ò–ö–ê ‚Äî –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≥–æ—Å—Ä–∞—Å—Ö–æ–¥–æ–≤ –∏ –Ω–∞–ª–æ–≥–æ–≤.
–ì–æ—Å–±—é–¥–∂–µ—Ç = –±–∞–ª–∞–Ω—Å –¥–æ—Ö–æ–¥–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤ (–∑–∞ –≥–æ–¥). B = T ‚àí G.
–°–∞–ª—å–¥–æ: B0 (—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π), B‚àí –¥–µ—Ñ–∏—Ü–∏—Ç (T<G), B+ –ø—Ä–æ—Ñ–∏—Ü–∏—Ç (T>G).

–¢–ò–ü–´:
- –°—Ç–∏–º—É–ª–∏—Ä—É—é—â–∞—è (—ç–∫—Å–ø–∞–Ω—Å–∏–æ–Ω–∏—Å—Ç—Å–∫–∞—è): –≤ –ø–µ—Ä–∏–æ–¥ —Å–ø–∞–¥–∞. ‚ÜëG, ‚ÜëTr, ‚ÜìT. –î–µ—Ñ–∏—Ü–∏—Ç –±—é–¥–∂–µ—Ç–∞.
- –û–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª—å–Ω–∞—è (—Ä–µ—Å—Ç—Ä–∏–∫—Ü–∏–æ–Ω–Ω–∞—è): –≤ –ø–µ—Ä–∏–æ–¥ –±—É–º–∞. ‚ÜìG, ‚ÜìTr, ‚ÜëT. –ü—Ä–æ—Ñ–∏—Ü–∏—Ç –±—é–¥–∂–µ—Ç–∞.

–ú–£–õ–¨–¢–ò–ü–õ–ò–ö–ê–¢–û–† –ì–û–°–†–ê–°–•–û–î–û–í: kG = 1/(1‚àíMPC). ŒîY = kG¬∑ŒîG.
–ú–£–õ–¨–¢–ò–ü–õ–ò–ö–ê–¢–û–† –ù–ê–õ–û–ì–û–í: kT = ‚àíMPC/(1‚àíMPC). ŒîY = kT¬∑ŒîT.
–°–ë–ê–õ–ê–ù–°–ò–†–û–í–ê–ù–ù–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï (ŒîG = ŒîT): ŒîY = ŒîG (—Ç–µ–æ—Ä–µ–º–∞ –•–∞–∞–≤–µ–ª—å–º–æ, –º—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä = 1).

–í–ò–î–´ –§–ò–°–ö–ê–õ–¨–ù–û–ô –ü–û–õ–ò–¢–ò–ö–ò:
- –î–∏—Å–∫—Ä–µ—Ü–∏–æ–Ω–Ω–∞—è (–∞–∫—Ç–∏–≤–Ω–∞—è): —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è, ‚ÜëG –≤ –∫—Ä–∏–∑–∏—Å.
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è (–ø–∞—Å—Å–∏–≤–Ω–∞—è): –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ç–æ—Ä—ã (–ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ –Ω–∞–ª–æ–≥–∏, –ø–æ—Å–æ–±–∏—è –ø–æ –±–µ–∑—Ä–∞–±–æ—Ç–∏—Ü–µ).

–í–°–¢–†–û–ï–ù–ù–´–ï –°–¢–ê–ë–ò–õ–ò–ó–ê–¢–û–†–´:
- –ü—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∞–ª–æ–≥–∏: –∫—Ä–∏–∑–∏—Å ‚Üí Y‚Üì ‚Üí –Ω–∞–ª–æ–≥–∏‚Üì ‚Üí –ø–∞–¥–µ–Ω–∏–µ —Å–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è.
- –ü–æ—Å–æ–±–∏—è –ø–æ –±–µ–∑—Ä–∞–±–æ—Ç–∏—Ü–µ: –∫—Ä–∏–∑–∏—Å ‚Üí –±–µ–∑—Ä–∞–±–æ—Ç–∏—Ü–∞‚Üë ‚Üí –ø–æ—Å–æ–±–∏—è‚Üë ‚Üí —Ä–∞—Å—Ö–æ–¥—ã –ø–∞–¥–∞—é—Ç –º–µ–Ω—å—à–µ.

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
–¢–ï–ú–ê 8: –î–ï–ù–¨–ì–ò –ò –î–ï–ù–ï–ñ–ù–û-–ö–†–ï–î–ò–¢–ù–ê–Ø –ü–û–õ–ò–¢–ò–ö–ê
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

–î–ï–ù–¨–ì–ò: —Å—Ä–µ–¥—Å—Ç–≤–æ –æ–±—Ä–∞—â–µ–Ω–∏—è, –º–µ—Ä–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏, —Å—Ä–µ–¥—Å—Ç–≤–æ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è.
–î–µ–Ω–µ–∂–Ω–∞—è –º–∞—Å—Å–∞: –∞–≥—Ä–µ–≥–∞—Ç—ã M0, M1, M2, M3.

–î–ï–ü–û–ó–ò–¢–ù–´–ô –ú–£–õ–¨–¢–ò–ü–õ–ò–ö–ê–¢–û–†: mD = 1/rr_–æ–±, –≥–¥–µ rr_–æ–± ‚Äî –Ω–æ—Ä–º–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑–µ—Ä–≤–æ–≤.
–ü—Ä–∏–º–µ—Ä 4.1: D=100 –º–ª–Ω, rr=10%, R–∏–∑–± = 100 ‚àí 0,1√ó100 = 90 –º–ª–Ω. –ü—Ä–∏ rr=12,5% R–∏–∑–±=87,5 –º–ª–Ω.
–ü—Ä–∏–º–µ—Ä 4.2: mD=1/0,10=10. ŒîD = mD¬∑R–∏–∑–± = 10√ó90 = 900 –º–ª–Ω. –ü—Ä–∏ rr=12,5% mD=8, ŒîD=8√ó87,5=700 –º–ª–Ω.

–ú–û–ù–ï–¢–ê–†–ù–ê–Ø –ü–û–õ–ò–¢–ò–ö–ê ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–µ–Ω–µ–∂–Ω–æ–π –º–∞—Å—Å–æ–π –∏ –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–º–∏ —Å—Ç–∞–≤–∫–∞–º–∏.
–ö–æ–Ω–µ—á–Ω—ã–µ —Ü–µ–ª–∏: —Ä–æ—Å—Ç, –∑–∞–Ω—è—Ç–æ—Å—Ç—å, —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ü–µ–Ω, —Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ –ø–ª–∞—Ç—ë–∂–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞.
–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã: –Ω–æ—Ä–º–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑–µ—Ä–≤–æ–≤; —É—á—ë—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞ (–∫–ª—é—á–µ–≤–∞—è); –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞ –æ—Ç–∫—Ä—ã—Ç–æ–º —Ä—ã–Ω–∫–µ.

–í–ò–î–´:
| –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | –°—Ç–∏–º—É–ª–∏—Ä—É—é—â–∞—è | –û–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª—å–Ω–∞—è |
|---|---|---|
| –ù–æ—Ä–º–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑–µ—Ä–≤–æ–≤ | –°–Ω–∏–∂–µ–Ω–∏–µ | –ü–æ–≤—ã—à–µ–Ω–∏–µ |
| –£—á—ë—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞ | –°–Ω–∏–∂–µ–Ω–∏–µ | –ü–æ–≤—ã—à–µ–Ω–∏–µ |
| –û–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞ –æ—Ç–∫—Ä—ã—Ç–æ–º —Ä—ã–Ω–∫–µ | –ü–æ–∫—É–ø–∫–∞ –æ–±–ª–∏–≥–∞—Ü–∏–π –¶–ë | –ü—Ä–æ–¥–∞–∂–∞ –æ–±–ª–∏–≥–∞—Ü–∏–π –¶–ë |

–¢–†–ê–ù–°–ú–ò–°–°–ò–û–ù–ù–´–ô –ú–ï–•–ê–ù–ò–ó–ú –î–ö–ü:
–ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–µ–Ω–µ–∂–Ω–æ–π –º–∞—Å—Å—ã ‚Üí –ò–∑–º–µ–Ω–µ–Ω–∏–µ % —Å—Ç–∞–≤–∫–∏ ‚Üí –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π ‚Üí –ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ–±—ä—ë–º–∞ –≤—ã–ø—É—Å–∫–∞.

–ò–ù–§–õ–Ø–¶–ò–û–ù–ù–û–ï –¢–ê–†–ì–ï–¢–ò–†–û–í–ê–ù–ò–ï: –¶–ë –†–§ ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ –∏–Ω—Ñ–ª—è—Ü–∏–∏ –≤–±–ª–∏–∑–∏ 4%.

–õ–ò–ö–í–ò–î–ù–ê–Ø –õ–û–í–£–®–ö–ê: –≤—ã—Å–æ–∫–∞—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–ø—Ä–æ—Å–∞ –Ω–∞ –¥–µ–Ω—å–≥–∏ –∫ % —Å—Ç–∞–≤–∫–µ ‚Üí –î–ö–ü –∞–±—Å–æ–ª—é—Ç–Ω–æ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞.

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
–ü–†–ò–ú–ï–†–´ –ó–ê–î–ê–ß –ò –†–ï–®–ï–ù–ò–ô
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

–ê–õ–ì–û–†–ò–¢–ú –ó–ê–î–ê–ß–ò 1 (–∑–∞–¥–∞–Ω–∏–µ –∏–∑ –ø—Ä–∞–∫—Ç–∏–∫–∏):
–î–∞–Ω–æ: C=500, I=100, G ‚àí T_—á–∏—Å—Ç = 50 (–¥–µ—Ñ–∏—Ü–∏—Ç), T = 0,3Y, Tr = (1/3)¬∑T, NX=30.
–ß–∏—Å—Ç—ã–µ –Ω–∞–ª–æ–≥–∏ T_—á–∏—Å—Ç = T ‚àí Tr = 0,3Y ‚àí (1/3)¬∑0,3Y = 0,3Y ‚àí 0,1Y = 0,2Y.
G = T_—á–∏—Å—Ç + 50 = 0,2Y + 50.
Y = C + I + G + NX = 500 + 100 + (0,2Y + 50) + 30.
Y = 680 + 0,2Y ‚Üí 0,8Y = 680 ‚Üí Y = 850. G = 0,2√ó850 + 50 = 220.

–ó–ê–î–ê–ß–ê 2 (–∏–∑ –∑–∞–¥–∞–Ω–∏—è):
–î–∞–Ω–æ: Y=3000, I=600, EX=500, IM=300, T‚àíG=100 (–ø—Ä–æ—Ñ–∏—Ü–∏—Ç), Tr=0, –£—Ç–µ—á–∫–∏=1800.
NX = EX ‚àí IM = 500 ‚àí 300 = 200.
C = Y ‚àí I ‚àí G ‚àí NX: —Å–Ω–∞—á–∞–ª–∞ G = T ‚àí 100. –£—Ç–µ—á–∫–∏ = S + T + IM = 1800.
T_—á–∏—Å—Ç = T (Tr=0). –ò–∑ Y=C+I+G+NX: C = Y ‚àí I ‚àí G ‚àí NX = 3000 ‚àí 600 ‚àí G ‚àí 200.
T ‚àí G = 100 ‚Üí G = T ‚àí 100. –£—Ç–µ—á–∫–∏: S + T + 300 = 1800 ‚Üí S + T = 1500.
S = Y ‚àí C ‚àí T (—á–∞—Å—Ç–Ω—ã–µ —Å–±–µ—Ä–µ–∂–µ–Ω–∏—è). SN = S + (T‚àíG) = S + 100.
–ò–∑ C = Y ‚àí I ‚àí G ‚àí NX –∏ –£—Ç–µ—á–∫–∏=S+T+IM=1800: S = 1800 ‚àí T ‚àí 300 = 1500 ‚àí T.
C = Y ‚àí S ‚àí T = 3000 ‚àí 1500 = 1500. SN = 1500 ‚àí T + 100. T = Y ‚àí C ‚àí I ‚àí G ‚àí NX –Ω–µ—Ç –ø—Ä—è–º–æ.
–ü—Ä—è–º–æ: C = Y ‚àí (S+T+IM) + IM ‚àí I ‚àí G + G ‚Üí C = 3000 ‚àí 1800 + 300 ‚àí 600 = 900.
S_—á–∞—Å—Ç–Ω = –£—Ç–µ—á–∫–∏ ‚àí T_—á–∏—Å—Ç ‚àí IM = 1800 ‚àí T ‚àí 300. –ò–∑ T‚àíG=100 –∏ G+C+I+NX=Y: G=3000‚àí900‚àí600‚àí200=1300. T=1300+100=1400.
C=900, S_—á–∞—Å—Ç–Ω=1800‚àí1400‚àí300=100. SN=100+100=200.

–ó–ê–î–ê–ß–ê 3:
–î–∞–Ω–æ: C=1500, G=450, Tr=200, T=250, NX=‚àí150, EX=100, –ò–Ω—ä–µ–∫—Ü–∏–∏=1200.
IM = EX ‚àí NX = 100 ‚àí (‚àí150) = 250.
–ò–Ω—ä–µ–∫—Ü–∏–∏ = I + G + EX = 1200 ‚Üí I = 1200 ‚àí 450 ‚àí 100 = 650.
–í–í–ü = C + I + G + NX = 1500 + 650 + 450 + (‚àí150) = 2450.
T_—á–∏—Å—Ç = T ‚àí Tr = 250 ‚àí 200 = 50. S_—á–∞—Å—Ç–Ω = Y ‚àí C ‚àí T_—á–∏—Å—Ç = 2450 ‚àí 1500 ‚àí 50 = 900.
SN = S_—á–∞—Å—Ç–Ω + (T_—á–∏—Å—Ç ‚àí G) = 900 + (50 ‚àí 450) = 900 ‚àí 400 = 500.
–í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ = Y ‚àí NX = 2450 ‚àí (‚àí150) = 2600. (–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ: Y ‚àí EX + IM = 2450 ‚àí 100 + 250 = 2600.)
`;

// ========================================================
//  KNOWLEDGE BASE ‚Äî TOUCHSTONE 3
// ========================================================

const TS3_KB = `
=== TOUCHSTONE 3 (Cambridge University Press, B1) ===

UNIT 1: manner adverbs (quickly, slowly, carefully, hard, fast, well, badly), personality adj (outgoing, shy, organized, impatient, reliable, arrogant, considerate, dishonest), prefixes im-/in-/un-/dis-, always+continuous –¥–ª—è –ø—Ä–∏–≤—ã—á–µ–∫.

UNIT 2: Present Perfect (Have you ever...? / I've never...), irregular verbs: be‚Üíwas/were‚Üíbeen; see‚Üísaw‚Üíseen; go‚Üíwent‚Üígone; do‚Üídid‚Üídone; drive‚Üídrove‚Üídriven; eat‚Üíate‚Üíeaten; drink‚Üídrank‚Üídrunk; fall‚Üífell‚Üífallen; forget‚Üíforgot‚Üíforgotten; get‚Üígot‚Üígotten; give‚Üígave‚Üígiven; sing‚Üísang‚Üísung; take‚Üítook‚Üítaken; wake‚Üíwoke‚Üíwoken; break‚Üíbroke‚Üíbroken; choose‚Üíchose‚Üíchosen; speak‚Üíspoke‚Üíspoken; write‚Üíwrote‚Üíwritten; come‚Üícame‚Üícome; bring‚Üíbrought‚Üíbrought; buy‚Üíbought‚Üíbought; catch‚Üícaught‚Üícaught; find‚Üífound‚Üífound; hear‚Üíheard‚Üíheard; keep‚Üíkept‚Üíkept; leave‚Üíleft‚Üíleft; make‚Üímade‚Üímade; meet‚Üímet‚Üímet; say‚Üísaid‚Üísaid; sell‚Üísold‚Üísold; teach‚Üítaught‚Üítaught; tell‚Üítold‚Üítold; think‚Üíthought‚Üíthought; win‚Üíwon‚Üíwon.

UNIT 3: Superlatives (the tallest, the most expensive), How+adj (How deep? How long?), superlatives —Å nouns.

UNIT 4: used to + bare inf (I used to walk / I didn't use to eat), would –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –ø—Ä–æ—à–ª—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π, make/let/have + obj + base verb.

UNIT 5: Countable/uncountable, a lot of/much/many/a little/a few/some/any, cooking methods (fried/boiled/steamed/grilled/baked/stir-fried/roasted/raw/smoked/pickled), food collocations.

UNIT 6: Future forms (will/going to/pres.cont./simple pres.), ought to/had better/would rather/have got to, make vs do collocations.

UNIT 7: Relative clauses (who/that/which), object relative pronoun can be omitted, phrasal verbs (get along with/break up/go out with/fall for/ask out).

UNIT 8 *** –ö–õ–Æ–ß–ï–í–û–ô ***
WISHES (–Ω–µ—Ä–µ–∞–ª—å–Ω—ã–µ –æ –Ω–∞—Å—Ç–æ—è—â–µ–º): I wish + past simple.
‚Üí I wish I had more time. / I wish I weren't so busy. / I wish I could speak Spanish. / I wish I didn't have to work.
‚Üí "I wish I was" = —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π; "I wish I were" = —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π.
SECOND CONDITIONAL: If + past simple ‚Üí would/could/might + base verb.
‚Üí If I had more money, I'd travel. / If she lived closer, she could help.
–û–®–ò–ë–ö–ê: ‚ùå "If I would have..." ‚Üí ‚úÖ "If I had..."
Workbook Unit 8 Lesson A: Ex.1 ‚Äî –≤—ã–±–æ—Ä —Ñ–æ—Ä–º—ã; Ex.2 ‚Äî –¥–æ–ø–æ–ª–Ω–∏ wish; Ex.3 ‚Äî –Ω–∞–ø–∏—à–∏ wishes; Ex.4 ‚Äî second conditional; Ex.5 ‚Äî –∏—Å–ø—Ä–∞–≤—å –æ—à–∏–±–∫–∏.

UNIT 9: Embedded questions (Do you know what the problem IS? ‚Äî –ø–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤ –∫–∞–∫ –≤ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏!), separable phrasal verbs (turn on/off, plug in, set up ‚Äî Turn it on, NOT Turn on it).

UNIT 10: Present Perfect Continuous (have/has + been + -ing), for (duration) vs since (starting point).

UNIT 11: look/seem/appear + adj, must/might/could/can't –¥–ª—è –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–π.

UNIT 12: Simple past passive (was/were + past participle), by-phrase.
`;

// ========================================================
//  KNOWLEDGE BASE ‚Äî MATH
// ========================================================

const MATH_KB = `
=== –ú–ê–¢–ï–ú–ê–¢–ò–ö–ê ‚Äî –ú–ï–¢–û–î–´ –ò –°–¢–ò–õ–¨ –†–ï–®–ï–ù–ò–Ø ===

–§–û–†–ú–ê–¢: —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, –ø–æ—à–∞–≥–æ–≤—ã–π. –§–æ—Ä–º—É–ª—ã ‚Äî –≤ –±–ª–æ–∫–∞—Ö ‚îÅ‚îÅ‚îÅ. –ö–∞–∂–¥—ã–π —à–∞–≥ ‚Äî –®–∞–≥ N: ... –û—Ç–≤–µ—Ç ‚Äî ‚úÖ –û–¢–í–ï–¢:

–ú–ï–¢–û–î–´:
Œ¥.–º.=–±–µ—Å–∫–æ–Ω–µ—á–Ω–æ –º–∞–ª–∞—è; Œ¥.–±.=–±–µ—Å–∫–æ–Ω–µ—á–Ω–æ –±–æ–ª—å—à–∞—è. –±.–º.¬∑–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è=0.
–ù–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç–∏: [‚àû/‚àû] ‚Äî –≤—ã–Ω–æ—Å –Ω–∞–∏–±–æ–ª—å—à–µ–π —Å—Ç–µ–ø–µ–Ω–∏; [0/0] ‚Äî —Ä–∞–∑–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –º–Ω–æ–∂–∏—Ç–µ–ª–∏/—Å–æ–ø—Ä—è–∂—ë–Ω–Ω–æ–µ/–∑–∞–º–µ–Ω–∞.
–†–∞–∑–ª–æ–∂–µ–Ω–∏—è: a¬≤‚àíb¬≤=(a‚àíb)(a+b); a¬≥‚àíb¬≥=(a‚àíb)(a¬≤+ab+b¬≤); a¬≥+b¬≥=(a+b)(a¬≤‚àíab+b¬≤).
I –∑–∞–º–µ—á–∞—Ç–µ–ª—å–Ω—ã–π –ø—Ä–µ–¥–µ–ª: lim sinx/x = 1 –ø—Ä–∏ x‚Üí0.
–≠–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç–∏ Œ±‚Üí0: sinŒ±~Œ±; tgŒ±~Œ±; 1‚àícosŒ±~Œ±¬≤/2; eÀ£‚àí1~x; ln(1+x)~x; ‚àö(1+x)‚àí1~x/2; (1+x)‚Åø‚àí1~nx.
`;

// ========================================================
//  KNOWLEDGE BASE ‚Äî BUSINESS STUDIO
// ========================================================

const BP_KB = `
=== BUSINESS STUDIO (–ú–æ–∫–µ–µ–≤ –í.–í., –Æ–£—Ä–ì–£, 2013) ===

–ù–û–¢–ê–¶–ò–ò: IDEF0, BP Flowchart (–ü—Ä–æ—Ü–µ—Å—Å), Cross Functional FlowChart (–ü—Ä–æ—Ü–µ–¥—É—Ä–∞), EPC.

5 –¢–ò–ü–û–í –°–¢–†–ï–õ–û–ö IDEF0 (ICOM):
1. –í–•–û–î (Input) ‚Äî –°–õ–ï–í–ê. –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è. –ú–æ–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å.
2. –£–ü–†–ê–í–õ–ï–ù–ò–ï (Control) ‚Äî –°–í–ï–†–•–£. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê. –í–ª–∏—è–µ—Ç, –Ω–µ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è.
3. –í–´–•–û–î (Output) ‚Äî –°–ü–†–ê–í–ê. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê. –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ—Ü–µ—Å—Å–∞.
4. –ú–ï–•–ê–ù–ò–ó–ú (Mechanism) ‚Äî –°–ù–ò–ó–£. –†–µ—Å—É—Ä—Å—ã/–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏.
5. –í–´–ó–û–í (Call) ‚Äî –°–ù–ò–ó–£ –Ω–∞—Ä—É–∂—É. –°–≤—è–∑—å —Å –¥—Ä—É–≥–æ–π –º–æ–¥–µ–ª—å—é.

–î–ò–ê–ì–†–ê–ú–ú–´: A-0 (–∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è, –æ–¥–Ω–∞ –Ω–∞ –≤—Å—é –º–æ–¥–µ–ª—å), A0/A1/A2... (–¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏), –¥–µ—Ä–µ–≤–æ —É–∑–ª–æ–≤, FEO.
–ò–ï–†–ê–†–•–ò–Ø –ù–ê–í–ò–ì–ê–¢–û–†–ê: –ü–∞–ø–∫–∞‚Üí–ü—Ä–æ—Ü–µ—Å—Å IDEF0‚Üí–ü—Ä–æ—Ü–µ—Å—Å BP Flowchart‚Üí–ü—Ä–æ—Ü–µ–¥—É—Ä–∞ CFFC‚Üí–î–µ–π—Å—Ç–≤–∏–µ.
–¢–£–ù–ù–ï–õ–ò–†–û–í–ê–ù–ò–ï: –ø–æ–ª—ã–π –Ω–∞–∫–æ–Ω–µ—á–Ω–∏–∫ ‚Äî —Å—Ç—Ä–µ–ª–∫–∞ —Å–∫—Ä—ã—Ç–∞ –æ—Ç —Ä–æ–¥–∏—Ç–µ–ª—è/–¥–æ—á–µ—Ä–Ω–µ–π.
–°–£–ë–™–ï–ö–¢–´: –î–æ–ª–∂–Ω–æ—Å—Ç—å | –ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ | –í–Ω–µ—à–Ω–∏–π —Å—É–±—ä–µ–∫—Ç | –†–æ–ª—å.

–°–•–ï–ú–ê (ASCII) –¥–ª—è IDEF0 —Ä–∞–±–æ—Ç—ã:
         ‚Üì –£–ü–†–ê–í–õ–ï–ù–ò–ï
         |
–í–•–û–î ‚Üí [–†–ê–ë–û–¢–ê] ‚Üí –í–´–•–û–î
         |
         ‚Üë –ú–ï–•–ê–ù–ò–ó–ú

–ü–†–ò–ú–ï–† "–°–±–æ—Ä–∫–∞ –ü–ö": A-0: –≤—Ö–æ–¥=–ó–≤–æ–Ω–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤; —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ=–ü—Ä–∞–≤–∏–ª–∞ –∫–æ–º–ø–∞–Ω–∏–∏; –≤—ã—Ö–æ–¥=–ü—Ä–æ–¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã; –º–µ—Ö–∞–Ω–∏–∑–º=–ë—É—Ö—Å–∏—Å—Ç–µ–º–∞. A0: A1=–ü—Ä–æ–¥–∞–∂–∏; A2=–°–±–æ—Ä–∫–∞; A3=–û—Ç–≥—Ä—É–∑–∫–∞.
`;

// ========================================================
//  KNOWLEDGE BASE ‚Äî RUSSIAN
// ========================================================

const RU_KB = `
=== –†–£–°–°–ö–ò–ô –Ø–ó–´–ö ‚Äî –ù–û–†–ú–´ –†–ê–ù ===

–£–î–ê–†–ï–ù–ò–Ø (–†–ê–ù, –ó–∞–ª–∏–∑–Ω—è–∫, –†–µ–∑–Ω–∏—á–µ–Ω–∫–æ):
–¥–æ–≥–æ–≤–û—Ä; –∑–≤–æ–Ω–ò—Ç/–∑–≤–æ–Ω–ò—à—å/–ø–æ–∑–≤–æ–Ω–ò—Ç; —Ç–û—Ä—Ç—ã; –∫—Ä–∞—Å–ò–≤–µ–µ; –∫–∞—Ç–∞–ª–û–≥; —Å—Ç–æ–ª–Ø—Ä; —à–æ—Ñ–Å—Ä; —Å—Ä–µ–¥—Å—Ç–≤–ê; –∂–∞–ª—é–∑–ò; –∫–≤–∞—Ä—Ç–ê–ª; –≤–∫–ª—é—á–ò—Ç; –æ–±–µ—Å–ø–ï—á–µ–Ω–∏–µ; —Ö–æ–¥–ê—Ç–∞–π—Å—Ç–≤–æ; –ø—Ä–∏–Ω—è–ª–ê; –Ω–ê—á–∞–ª–∞; –ø–æ–∑–≤–∞–ª–ê; —Å–æ–∑–¥–∞–ª–ê.

–û–†–§–û–ì–†–ê–§–ò–Ø: -–Ω–Ω- –∏—Å–∫–ª—é—á–µ–Ω–∏—è (—Å—Ç–µ–∫–ª—è–Ω–Ω—ã–π/–æ–ª–æ–≤—è–Ω–Ω—ã–π/–¥–µ—Ä–µ–≤—è–Ω–Ω—ã–π); -—Ç—Å—è/-—Ç—å—Å—è (—á—Ç–æ –¥–µ–ª–∞–µ—Ç?/-—Ç—å—Å—è); –ø—Ä–∏—Å—Ç–∞–≤–∫–∏ –Ω–∞ –∑/—Å; —å –ø–æ—Å–ª–µ —à–∏–ø—è—â–∏—Ö (–º—ã—à—å, –ø–∏—à–µ—à—å, –±–µ—Ä–µ—á—å).

–§–û–†–ú–ê–¢ –ü–†–û–í–ï–†–ö–ò: ‚ùå –ù–∞–ø–∏—Å–∞–Ω–æ ‚Üí ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ ‚Üí üìñ –ü—Ä–∞–≤–∏–ª–æ ‚Üí –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —Ü–µ–ª–∏–∫–æ–º.
`;

// ========================================================
//  SYSTEM PROMPTS
// ========================================================

function getSP() {
  const base = '–¢—ã ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —É—á–µ–±–Ω—ã–π –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç. –û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.';

  switch(subject) {
    case 'eng': return base + `\n\n–ü–†–ï–î–ú–ï–¢: –ê–ù–ì–õ–ò–ô–°–ö–ò–ô –Ø–ó–´–ö (Touchstone 3).\n\n${TS3_KB}\n\n–ü–†–ê–í–ò–õ–ê: –ï—Å–ª–∏ –Ω–∞–ø–∏—Å–∞–Ω–æ "Workbook Unit X Lesson Y" ‚Äî –ù–ï–ú–ï–î–õ–ï–ù–ù–û –≤—ã–ø–æ–ª–Ω–∏ –≤—Å–µ —Ç–∏–ø–∏—á–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è. –î–ª—è Unit 8 Lesson A: –¥–∞–π –æ—Ç–≤–µ—Ç—ã –Ω–∞ Ex.1-5 (wishes + second conditional). –ù—É–º–µ—Ä—É–π –æ—Ç–≤–µ—Ç—ã. –ü–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–æ–≤ ‚Äî üìñ –ü—Ä–∞–≤–∏–ª–æ: (–∫—Ä–∞—Ç–∫–æ–µ). –ï—Å–ª–∏ —Ñ–æ—Ç–æ ‚Äî –≤—ã–ø–æ–ª–Ω–∏ –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è —Å —Ñ–æ—Ç–æ.`;

    case 'math': return base + `\n\n–ü–†–ï–î–ú–ï–¢: –í–´–°–®–ê–Ø –ú–ê–¢–ï–ú–ê–¢–ò–ö–ê.\n\n${MATH_KB}\n\n–û–§–û–†–ú–õ–ï–ù–ò–ï: –ö–∞–∂–¥—ã–π —à–∞–≥ ‚Äî –Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞. –§–æ—Ä–º—É–ª—ã –≤ –±–ª–æ–∫–∞—Ö ‚îÅ‚îÅ‚îÅ. –¢–∏–ø –Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç–∏: [‚àû/‚àû]. –û—Ç–≤–µ—Ç: ‚úÖ –û–¢–í–ï–¢: –ù–µ–ª—å–∑—è –ø–∏—Å–∞—Ç—å –≤—Å—ë –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É.`;

    case 'bp': return base + `\n\n–ü–†–ï–î–ú–ï–¢: BUSINESS STUDIO / –ë–ò–ó–ù–ï–°-–ü–†–û–¶–ï–°–°–´.\n\n${BP_KB}\n\n–ü–†–ê–í–ò–õ–ê: –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ —Å—Ö–µ–º—ã IDEF0 ‚Äî —Ä–∏—Å—É–π ASCII –¥–∏–∞–≥—Ä–∞–º–º—É. –û–±—ä—è—Å–Ω—è–π: –ø—Ä–∞–≤–∏–ª–æ ‚Üí –ø—Ä–∏–º–µ—Ä ‚Üí –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ. –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ —Å—Ö–µ–º—ã –Ω–∞ –¥–∏–∞–≥—Ä–∞–º–º—É ‚Äî —Ä–∏—Å—É–π –µ—ë –≤ ASCII —Å –ø–æ–¥–ø–∏—Å—è–º–∏.`;

    case 'ru': return base + `\n\n–ü–†–ï–î–ú–ï–¢: –†–£–°–°–ö–ò–ô –Ø–ó–´–ö.\n\n${RU_KB}\n\n–ü–†–ê–í–ò–õ–ê: –ù–æ—Ä–º—ã –†–ê–ù —Å—Ç—Ä–æ–≥–æ. –ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ ‚Äî –Ω–∞–π–¥–∏ –í–°–ï –æ—à–∏–±–∫–∏. –í –∫–æ–Ω—Ü–µ ‚Äî –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç.`;

    case 'macro': return base + `\n\n–ü–†–ï–î–ú–ï–¢: –ú–ê–ö–†–û–≠–ö–û–ù–û–ú–ò–ö–ê.\n\n${MACRO_KB}\n\n–ü–†–ê–í–ò–õ–ê –†–ï–®–ï–ù–ò–Ø –ó–ê–î–ê–ß:
1. –ó–∞–ø–∏—Å—ã–≤–∞–π –≤—Å–µ —à–∞–≥–∏ –ø–æ–¥—Ä–æ–±–Ω–æ, –∫–∞–∫ –≤ —É—á–µ–±–Ω–∏–∫–µ
2. –ù–∞—á–∏–Ω–∞–π —Å –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–æ–∂–¥–µ—Å—Ç–≤–∞ Y = C + I + G + NX
3. –û–±–æ–∑–Ω–∞—á–∞–π –∫–∞–∂–¥—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
4. –ò—Å–ø–æ–ª—å–∑—É–π —Ñ–æ—Ä–º—É–ª—ã –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π (—á–∏—Å—Ç—ã–µ –Ω–∞–ª–æ–≥–∏, —Å–±–µ—Ä–µ–∂–µ–Ω–∏—è)
5. –í –∫–æ–Ω—Ü–µ ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∂–¥–µ—Å—Ç–≤–∞ —É—Ç–µ—á–µ–∫ –∏ –∏–Ω—ä–µ–∫—Ü–∏–π
6. –§–æ—Ä–º–∞—Ç:
   ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
   –î–∞–Ω–æ: [—É—Å–ª–æ–≤–∏–µ]
   ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
   –®–∞–≥ 1: [–¥–µ–π—Å—Ç–≤–∏–µ]
   ...
   ‚úÖ –û–¢–í–ï–¢: Y=..., G=...
   ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
7. –î–ª—è —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ ‚Äî –æ—Ç–≤–µ—á–∞–π –°–õ–û–í–û –í –°–õ–û–í–û –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π (–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π)
8. –ò—Å–ø–æ–ª—å–∑—É–π –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, —Ñ–æ—Ä–º—É–ª—ã –∏ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π`;

    default: return base + '\n–û—Ç–≤–µ—á–∞–π —á—ë—Ç–∫–æ –∏ –ø–æ –¥–µ–ª—É. –î–ª—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏ ‚Äî –ø–æ—à–∞–≥–æ–≤–æ —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏—è–º–∏.';
  }
}

// ========================================================
//  BADGE
// ========================================================

function getBadge() {
  const m = {
    gen: ['‚óè –û–±—â–∏–π —á–∞—Ç','sb-gen'],
    eng: ['‚óè –ê–Ω–≥–ª–∏–π—Å–∫–∏–π ¬∑ TS3','sb-eng'],
    math: ['‚óè –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞','sb-math'],
    bp: ['‚óè Business Studio','sb-bp'],
    ru: ['‚óè –†—É—Å—Å–∫–∏–π —è–∑—ã–∫','sb-ru'],
    macro: ['‚óè –ú–∞–∫—Ä–æ—ç–∫–æ–Ω–æ–º–∏–∫–∞','sb-macro']
  };
  return m[subject] || m.gen;
}

// ========================================================
//  SEND
// ========================================================

async function send() {
  if (busy) return;
  const ta = document.getElementById('ta');
  const txt = ta.value.trim();
  if (!txt && imgs.length === 0) return;

  const curImgs = [...imgs]; imgs = []; renderPrevs();
  ta.value = ''; ta.style.height = 'auto';
  document.getElementById('welcome').style.display = 'none';
  hideSt();

  renderMsg('user', txt, curImgs.map(i=>i.url));

  const parts = [];
  const userText = txt || '–ü–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ —Ñ–æ—Ç–æ –∏ –≤—ã–ø–æ–ª–Ω–∏ –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è. –ï—Å–ª–∏ —ç—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —É—á–µ–±–Ω–∏–∫–∞ –∏–ª–∏ —Ç–µ—Ç—Ä–∞–¥–∏ ‚Äî –ø—Ä–æ—á–∏—Ç–∞–π –∏ –≤—ã–ø–æ–ª–Ω–∏ –∫–∞–∂–¥–æ–µ –∑–∞–¥–∞–Ω–∏–µ –ø—Ä–æ–Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω–æ.';
  parts.push({type:'text', text: userText});
  curImgs.forEach(img => parts.push({type:'image_url', image_url:{url:`data:${img.mime};base64,${img.b64}`}}));

  msgs.push({role:'user', content: parts, _disp: txt});

  const typing = showTyping();
  busy = true;
  document.getElementById('sbtn').disabled = true;

  try {
    const isO = model.startsWith('o');
    const apiMsgs = [];
    if (!isO) apiMsgs.push({role:'system', content: getSP()});
    msgs.slice(-12).forEach(m => apiMsgs.push({role:m.role, content:m.content}));

    const body = {model, messages: apiMsgs, max_completion_tokens: 4096};
    if (!isO) body.temperature = 0.1;

    const res = await fetch('https://api.openai.com/v1/chat/completions', {
      method:'POST',
      headers:{'Content-Type':'application/json','Authorization':`Bearer ${API_KEY}`},
      body: JSON.stringify(body)
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.error?.message || `HTTP ${res.status}`);

    const reply = data.choices[0].message.content;
    typing.remove();
    renderMsg('assistant', reply, []);
    msgs.push({role:'assistant', content:reply, _disp:reply});
    saveHistory();

  } catch(err) {
    typing.remove();
    let m = err.message;
    if (m.includes('401')) m = '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ ‚Äî –ø—Ä–æ–≤–µ—Ä—å –∫–ª—é—á';
    if (m.includes('429')) m = '–õ–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Äî –ø–æ–¥–æ–∂–¥–∏ 30 —Å–µ–∫.';
    if (m.includes('quota')||m.includes('billing')) m = '–ò—Å—á–µ—Ä–ø–∞–Ω –±–∞–ª–∞–Ω—Å OpenAI';
    if (m.includes('fetch')||m.includes('Failed')) m = '–ù–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞';
    showSt('err','‚ùå '+m);
  }

  busy = false;
  document.getElementById('sbtn').disabled = false;
}

function qs(text) { document.getElementById('ta').value = text; send(); }
function setTabAndSend(tab, text) {
  document.querySelectorAll('.tab').forEach(t=>t.classList.toggle('on', t.dataset.s===tab));
  subject = tab;
  document.getElementById('ta').value = text;
  send();
}

// ========================================================
//  RENDER
// ========================================================

function renderMsg(role, content, images=[]) {
  const c = document.getElementById('msgs');
  const wrap = document.createElement('div');
  wrap.className = `msg ${role==='user'?'usr':''}`;

  const av = document.createElement('div');
  av.className = `av ${role==='assistant'?'aiav':'usrav'}`;
  av.textContent = role==='assistant'?'AI':'üë§';

  const bub = document.createElement('div');
  bub.className = `bub ${role==='assistant'?'aibub':'usrbub'}`;

  if (images.length===1) { const img=document.createElement('img'); img.src=images[0]; bub.appendChild(img); }
  else if (images.length>1) {
    const g=document.createElement('div'); g.className='imgrid';
    images.forEach(src=>{const img=document.createElement('img');img.src=src;g.appendChild(img);});
    bub.appendChild(g);
  }

  if (role==='assistant') {
    const [lbl,cls]=getBadge();
    const b=document.createElement('div'); b.className=`sbadge ${cls}`; b.textContent=lbl;
    bub.appendChild(b);
  }

  if (content) {
    const t=document.createElement('div');
    t.innerHTML = fmt(content, role==='assistant');
    bub.appendChild(t);
  }

  wrap.appendChild(av); wrap.appendChild(bub);
  c.appendChild(wrap); scrollBottom();
}

function fmt(text, isAI) {
  if (!text) return '';
  let h = text.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  h = h.replace(/```[\w]*\n?([\s\S]*?)```/g,(_,c)=>`<pre><code>${c.trim()}</code></pre>`);
  h = h.replace(/`([^`]+)`/g,'<code>$1</code>');
  if (isAI) {
    h = h.replace(/(‚îÅ+[^]*?‚îÅ+)/g,'<div class="math-blk">$1</div>');
    h = h.replace(/^(–®–∞–≥\s*\d+[:.Ôºö][^\n]*)/gm,'<span class="step-lbl">$1</span>');
    h = h.replace(/(‚úÖ\s*–û–¢–í–ï–¢[:\s][^\n]+)/g,'<div class="ans-box">$1</div>');
    h = h.replace(/((?:üí°|üìñ)\s*–ü—Ä–∞–≤–∏–ª[–æ–∞][:\s][^\n]+)/g,'<div class="rule-box">$1</div>');
    h = h.replace(/(‚ùå[^\n<]+)/g,'<span class="err-l">$1</span>');
    h = h.replace(/(‚úÖ[^\n<]+)/g,'<span class="ok-l">$1</span>');
    h = h.replace(/\*\*([^*\n]+)\*\*/g,'<strong>$1</strong>');
    h = h.replace(/\*([^*\n]+)\*/g,'<em style="color:#a5b4fc;font-style:normal">$1</em>');
  }
  h = h.replace(/\n\n/g,'<br><br>').replace(/\n/g,'<br>');
  return h;
}

function showTyping() {
  const c=document.getElementById('msgs');
  const el=document.createElement('div'); el.className='msg';
  el.innerHTML='<div class="av aiav">AI</div><div class="bub aibub"><div class="typing-wrap"><span></span><span></span><span></span></div></div>';
  c.appendChild(el); scrollBottom(); return el;
}

function scrollBottom() {
  requestAnimationFrame(()=>{
    const c=document.getElementById('msgs'); c.scrollTop=c.scrollHeight;
  });
}

// ========================================================
//  FILES
// ========================================================

function onFiles(e) {
  Array.from(e.target.files).forEach(f => {
    if (!f.type.startsWith('image/')) return;
    const r=new FileReader();
    r.onload=ev=>{imgs.push({url:ev.target.result,b64:ev.target.result.split(',')[1],mime:f.type});renderPrevs();};
    r.readAsDataURL(f);
  });
  e.target.value='';
}
function renderPrevs() {
  const c=document.getElementById('prevs'); c.innerHTML='';
  imgs.forEach((img,i)=>{
    const d=document.createElement('div'); d.className='prev';
    d.innerHTML=`<img src="${img.url}"><div class="rm" onclick="rmImg(${i})">‚úï</div>`;
    c.appendChild(d);
  });
}
function rmImg(i){imgs.splice(i,1);renderPrevs();}

// ========================================================
//  KEY
// ========================================================

function checkKey() {
  if (API_KEY && API_KEY.startsWith('sk-')) document.getElementById('keyscreen').classList.add('hidden');
}
async function saveKey() {
  const val=document.getElementById('ksinp').value.trim();
  if (!val.startsWith('sk-')){document.getElementById('kserr').classList.add('show');return;}
  const btn=document.querySelector('.ksbtn');
  btn.textContent='–ü—Ä–æ–≤–µ—Ä—è–µ–º...';btn.disabled=true;
  try {
    const res=await fetch('https://api.openai.com/v1/models',{headers:{'Authorization':'Bearer '+val}});
    if(!res.ok) throw 0;
    localStorage.setItem('api_key',val);API_KEY=val;
    document.getElementById('keyscreen').classList.add('hidden');
    showSt('ok','‚úÖ –ö–ª—é—á —Å–æ—Ö—Ä–∞–Ω—ë–Ω');setTimeout(hideSt,3000);
  } catch {
    document.getElementById('kserr').classList.add('show');
    btn.textContent='‚Üí –í–æ–π—Ç–∏';btn.disabled=false;
  }
}
function changeKey() {
  localStorage.removeItem('api_key');API_KEY='';
  document.getElementById('ov').classList.remove('open');
  document.getElementById('ksinp').value='';
  document.getElementById('kserr').classList.remove('show');
  const btn=document.querySelector('.ksbtn');btn.textContent='‚Üí –í–æ–π—Ç–∏';btn.disabled=false;
  document.getElementById('keyscreen').classList.remove('hidden');
}

// ========================================================
//  SETTINGS
// ========================================================

function pickModel(el){document.querySelectorAll('.mopt').forEach(m=>m.classList.remove('on'));el.classList.add('on');model=el.dataset.m;}
function saveSettings(){localStorage.setItem('model',model);document.getElementById('ov').classList.remove('open');showSt('ok','‚úÖ '+model);setTimeout(hideSt,2500);}

function clearChat() {
  if(!confirm('–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é?')) return;
  msgs=[];localStorage.removeItem('ch');
  document.getElementById('msgs').innerHTML=`<div class="welcome" id="welcome">
    <div class="welcome-hero"><div class="glow">üéì</div><h2>–í—ã–±–µ—Ä–∏ –ø—Ä–µ–¥–º–µ—Ç –∏ –∑–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å</h2><p>–ü—Ä–∏–∫—Ä–µ–ø–∏ —Ñ–æ—Ç–æ –∑–∞–¥–∞–Ω–∏—è –∏–ª–∏ –Ω–∞–ø–∏—à–∏ ‚Äî —Ä–µ—à—É –ø–æ—à–∞–≥–æ–≤–æ</p></div>
    <div class="qgrid">
      <div class="qcard" data-c="eng" onclick="setTabAndSend('eng','–†–µ—à–∏ Workbook Unit 8 Lesson A ‚Äî –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è –ø–æ wishes –∏ second conditional')"><div class="qcard-ico">üìó</div><div class="qcard-title">Workbook Unit 8</div><div class="qcard-sub">Wishes & Conditionals</div></div>
      <div class="qcard" data-c="math" onclick="setTabAndSend('math','–í—ã—á–∏—Å–ª–∏ –ø—Ä–µ–¥–µ–ª: lim –ø—Ä–∏ x‚Üí‚àû –æ—Ç (x¬≤‚àí5x+11)/(3x¬≤+x+4). –û–±—ä—è—Å–Ω–∏ –∫–∞–∂–¥—ã–π —à–∞–≥.')"><div class="qcard-ico">üìê</div><div class="qcard-title">–ü—Ä–µ–¥–µ–ª —Ñ—É–Ω–∫—Ü–∏–∏</div><div class="qcard-sub">–ù–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç—å ‚àû/‚àû</div></div>
      <div class="qcard" data-c="macro" onclick="setTabAndSend('macro','–†–µ—à–∏ –∑–∞–¥–∞—á—É 1: C=500, I=100, G –ø—Ä–µ–≤—ã—Å–∏–ª–∏ —á–∏—Å—Ç—ã–µ –Ω–∞–ª–æ–≥–∏ –Ω–∞ 50, –Ω–∞–ª–æ–≥–∏ 30% –æ—Ç Y, —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä—Ç—ã —Ç—Ä–µ—Ç—å –Ω–∞–ª–æ–≥–æ–≤, NX=30. –ù–∞–π–¥–∏ Y –∏ G.')"><div class="qcard-ico">üìä</div><div class="qcard-title">–ú–∞–∫—Ä–æ—ç–∫–æ–Ω–æ–º–∏–∫–∞</div><div class="qcard-sub">–ó–∞–¥–∞—á–∞ –Ω–∞ –∫—Ä—É–≥–æ–æ–±–æ—Ä–æ—Ç</div></div>
      <div class="qcard" data-c="bp" onclick="setTabAndSend('bp','–û–±—ä—è—Å–Ω–∏ 5 —Ç–∏–ø–æ–≤ —Å—Ç—Ä–µ–ª–æ–∫ IDEF0 —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏. –ù–∞—Ä–∏—Å—É–π —Å—Ö–µ–º—É.')"><div class="qcard-ico">üóÇ</div><div class="qcard-title">IDEF0</div><div class="qcard-sub">5 —Ç–∏–ø–æ–≤ —Å—Ç—Ä–µ–ª–æ–∫</div></div>
    </div></div>`;
  document.getElementById('ov').classList.remove('open');
}

function ovClose(e){if(e.target===document.getElementById('ov'))document.getElementById('ov').classList.remove('open');}
function showSt(t,m){const el=document.getElementById('statusbar');el.className='statusbar '+t;el.textContent=m;}
function hideSt(){document.getElementById('statusbar').className='statusbar';}

// ========================================================
//  HISTORY
// ========================================================

function saveHistory() {
  try {
    localStorage.setItem('ch', JSON.stringify(
      msgs.slice(-40).map(m=>({role:m.role,content:typeof m.content==='string'?m.content:(m._disp||''),_disp:m._disp||''}))
    ));
  } catch(e){}
}

// ========================================================
//  INIT
// ========================================================

function init() {
  checkKey();

  const ta=document.getElementById('ta');
  ta.addEventListener('input',()=>{ta.style.height='auto';ta.style.height=Math.min(ta.scrollHeight,100)+'px';});
  ta.addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();send();}});

  document.getElementById('fi1').addEventListener('change',onFiles);
  document.getElementById('fi2').addEventListener('change',onFiles);

  document.querySelectorAll('.tab').forEach(t=>{
    t.addEventListener('click',()=>{
      document.querySelectorAll('.tab').forEach(x=>x.classList.remove('on'));
      t.classList.add('on'); subject=t.dataset.s;
    });
  });

  document.getElementById('settingsBtn').onclick=()=>document.getElementById('ov').classList.add('open');
  document.querySelectorAll('.mopt').forEach(m=>m.classList.toggle('on',m.dataset.m===model));

  try {
    const h=JSON.parse(localStorage.getItem('ch')||'[]');
    if(h.length){
      msgs=h;
      document.getElementById('welcome').style.display='none';
      h.forEach(m=>renderMsg(m.role,m._disp||m.content,[]));
    }
  } catch(e){}
}

init();
</script>


</body></html>